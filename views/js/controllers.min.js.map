{"version":3,"sources":["routes.js","../../taoTaskQueue/model/taskQueueModel.js","../../taoTaskQueue/model/taskQueue.js","../plugins/results/action/view.js","../plugins/results/action/delete.js","../plugins/results/action/download.js","../component/results/pluginsLoader.js","../component/results/areaBroker.js","../component/results/list!tpl","../component/results/list.js","../../taoTaskQueue/component/button/tpl/report!tpl","../../taoTaskQueue/component/button/css/taskable!css","../../taoTaskQueue/component/button/taskable.js","../../taoTaskQueue/component/button/tpl/treeButton!tpl","../../taoTaskQueue/component/button/css/treeButton!css","../../taoTaskQueue/component/button/treeButton.js","inspectResults.js","resultModal!tpl","resultsMonitoring.js","../../taoTaskQueue/component/button/standardButton.js","resultTable.js","json!taoItems/preview/resources/device-list.json","../../taoItems/preview/tpl/preview!tpl","../../taoItemsCss/preview!css","../../taoItems/preview/preview.js","viewResult.js","../../../../../../../../../../onLayerEnd0.js"],"names":["define","Results","actions","viewResult","index","ResultTable","ResultsMonitoring","$","_","Promise","eventifier","polling","request","hasSameState","task1","task2","status","_defaults","url","get","archive","all","download","pollSingleIntervals","iteration","interval","pollAllIntervals","config","model","_cache","singlePollings","getPollSingleIntervals","isArray","cloneDeep","getPollAllIntervals","defaults","setEndpoints","urls","assign","this","taskId","TypeError","then","taskData","id","trigger","reject","Error","catch","err","getAll","limit","newCache","forEach","task","difference","keys","res","pollAll","immediate","self","loop","pollingIntervals","_updateInterval","pollingInstance","pollingInterval","shift","setInterval","globalPolling","start","action","statusArr","done","async","taskDataArray","map","indexOf","resolve","next","pollAllStop","stop","pollSingle","poll","finished","pollSingleStop","create","data","taskCreate","creationResult","result","extra","fileDownload","httpMethod","successCallback","failCallback","urlHelper","taskQueueModelFactory","route","__","binder","pluginFactory","name","init","resultsList","getHost","binding","addAction","label","icon","context","classUri","getClassUri","exec","uri","encode","dialogConfirm","feedback","ajax","type","dataType","response","deleted","success","refresh","error","html","encodeHtml","fail","preparingMessageHtml","failMessageHtml","delivery","pluginLoader","actionView","actionDelete","actionDownload","areaBroker","requireAreas","partial","hb","template","Handlebars","depth0","helpers","partials","compilerInfo","merge","component","resultsAreaBroker","listTpl","resultsListFactory","pluginFactories","pluginRun","method","execStack","plugins","plugin","isFunction","push","isPlainObject","isString","dataUrl","decode","getListArea","datatable","descriptor","getConfig","getActions","before","$component","list","getName","empty","on","setState","filter","setTemplate","stack1","helper","buffer","functionType","escapeExpression","title","call","hash","reportFactory","loadingBar","reportTpl","defaultConfig","taskableComponent","setTaskConfig","createTask","taskQueue","requestUrl","requestData","taskCreationData","taskCreationUrl","infoBox","message","hasFile","taskLabel","timeout","info","sourceDom","getElement","displayReport","report","$reportContainer","taskReportContainer","render","find","off","makeTaskable","buttonTpl","buttonApi","is","initConfig","module","loggerFactory","resultsPluginsLoader","treeTaskButtonFactory","reportError","logger","taskButton","$container","listConfig","dataModel","exclude","remove","add","length","load","getPlugins","after","replace","register","actionContext","pick","uniqueValue","locale","resultModalTpl","getRequestErrorMessage","xhr","responseJSON","parseJSON","responseText","e","rowId","parseRowId","append","$resultsListContainer","modal","startClosed","minWidth","removeResult","downloadResult","split","sortable","paginationStrategyTop","paginationStrategyBottom","rows","view","loadingButton","terminate","reset","urlUtil","standardTaskButtonFactory","resulTableController","conf","$filterField","$tableContainer","columns","groups","$actionBar","buildGrid","col","resCol","isEqual","first","concat","_buildTable","prop","contextType","contextId","variableIdentifier","querytype","params","JSON","stringify","_search","each","$elt","group","preventDefault","$btn","toggleClass","select2","minimumResultsForSearch","click","tablets","193986c3715c81838870f908fa98d69a","width","height","4e8eafab11aad1486992d7ee2c8c16ca","5aac2932d9ad00d6d8a1604b8f9e4e8d","9805d9753ad08c7630a9ee5418aa6c6c","d4a431cedf4705d6bf2cba6d5788378b","phones","1b89338531ef0155c8d6abc2ac02c81a","scaleFactor","dpWidth","dpHeight","3f89da99d84214cde7df87ebe0699a6f","0d36971a5b98b367f54ced708c9af849","026beffcc051af995660ebdede986ace","fd2dd53e667d6d49e4fa73356fa941dd","707584c1ae17d9b5b2cbe8603c91c147","91823264de952e7f2347e07db5c4058b","cd69817a6e147e8a4677389e56fcf568","75994faa6a38e31e99b53fcd75534a33","0cab4dfccdfc880687cb608cfe4159db","c4ff41fcba24d74fc21dc3490ca1edc9","fa969a5e0dd2de53700eeee4ba4ba142","33c4f9364e295ec03531f3a3425819cf","bc47f5275f0efd56fee52d43a8082981","0732887e6e324fd10777b735520a34cf","2e38a78364f09d0da0e9e1a3a68e7fb0","bd4b78dddc7c9625a4141a1b1ddabb87","3bf1edf21cfa81006183d2b02974c84e","ab5a352e0e016b97dac986f06c394f55","4826fb7d7257aeaac992ce699df41b3c","0a691ab20add7c432200f8fa6527b488","9c23ee31be29960fbac9e9bbfc2fc7b0","92177c0508c1d73905a58e2338f2a81f","5222b8866dc4cc606725e16ffcc0a783","37c1541e2bd55cfd0f4073b0ccdf68b3","2f7f64b7dda0144907ff300e83eed465","9c24f9057744dad56043702a9703127f","0a8b2732a016a9395c3af5f12dd9c0da","5a153d7f53d82dcb0801f041574a6a43","screens","9e523ae15b61dc766f5c818726881ecf","07769cd8d0a7d09818b2f0b018042fb7","72d5478a24194f98b9378e8e0fd65737","b7a6dd5900cc72e61f0d3479c7e314ec","43193b0ff671a37d8232ab664190a125","c29e48814af5443ff5688d9e967ce917","program1","value","selected","inverse","noop","fn","program","program2","program4","themes","program6","dataValue","options","helperMissing","previewType","previewTypes","hasThemes","desktopDevices","mobileDevices","strPad","deviceList","previewTpl","themeHandler","themeLoader","UrlParser","_setupScreenSize","screenSize","innerWidth","innerHeight","overlay","container","typeDependant","$feedbackBox","$console","previewContainerMaxWidth","itemUri","state","orientation","desktop","mobile","standard","themeObj","$doc","document","$window","window","$body","body","sizeSettings","winScrollObj","x","y","_getDeviceSelectorData","devices","join","_setupTypeDependantElements","_setPreviewType","newType","re","RegExp","i","el","className","_setOrientation","newOrientation","previewFrame","_scale","_computeScaleFactor","$scaleContainer","_scaleFactor","containerScaledWidth","left","css","-webkit-transform","-ms-transform","transform","-webkit-transform-origin","-ms-transform-origin","transform-origin","_positionPreview","topBarHeight","outerHeight","style","top","maxHeight","scaleValues","requiredSize","Math","min","_setupDeviceSelectors","previewDeviceSelectors","elem","option","nodeName","toLowerCase","selectedIndex","val","parseFloat","_adaptFrameSize","_setupOrientationSelectors","_setupClosers","$closer","$feedbackCloser","$hideForever","$iframe","scrollTo","hide","removeClass","attr","keyup","keyCode","addClass","cookie","expires","path","_getThemes","activeTheme","isEmpty","base","getActiveTheme","available","_getPreviewTypes","_previewLabel","_previewType","_setupViewSelector","_setupThemeSelector","iframe","getElementById","iframeDoc","contentWindow","contentDocument","$previewContainer","_iframe","contentHeight","contents","containerHeight","_updateStandardPreviewSize","$selector","values","toString","valueStr","_initConsole","$listing","event","timer","Date","logTime","getHours","getMinutes","getSeconds","msgStr","scrollTop","slideDown","show","slideUp","parsed","scrollX","scrollY","display","not","statusText","_itemUri","_state","size","parseInt","section","preview","viewResultController","$resultFilterField","$classFilterField","classFilter","parse","filterTypes","filterSubmission","loadContentBlock","variableUri","deliveryUri","$this","c","d","a","s","createElement","getElementsByTagName","cssText","createTextNode"],"mappings":"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","file":"routes.js","sourcesContent":["/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\r\n * \r\n * \r\n */\r\n\r\n//@see http://forge.taotesting.com/projects/tao/wiki/Front_js\r\ndefine('taoOutcomeUi/controller/routes',[],function(){\r\n    'use strict';\r\n\r\n    return {\r\n        'Results': {\r\n            'actions': {\r\n                'viewResult' : 'controller/viewResult',\r\n                'index' : 'controller/inspectResults'\r\n            }\r\n        },\r\n        'ResultTable': {\r\n            'actions': {\r\n                'index' : 'controller/resultTable'\r\n            }\r\n        },\r\n        'ResultsMonitoring': {\r\n            'actions': {\r\n                'index': 'controller/resultsMonitoring'\r\n            }\r\n        }\r\n    };\r\n});\r\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA ;\n */\n\n/**\n * @example\n * taskQueueModelFactory({\n *        url : {\n *            get: urlHelper.route('get', 'TaskQueueWebApi', 'taoTaskQueue'),\n *            archive: urlHelper.route('archive', 'TaskQueueWebApi', 'taoTaskQueue'),\n *            all : urlHelper.route('getAll', 'TaskQueueWebApi', 'taoTaskQueue'),\n *            download : urlHelper.route('download', 'TaskQueueWebApi', 'taoTaskQueue')\n *        },\n *        pollSingleIntervals : [\n *            {iteration: 4, interval:1000},\n *        ],\n *        pollAllIntervals : [\n *            {iteration: 0, interval:5000},\n *        ]\n *    }).pollAll()\n */\ndefine('taoTaskQueue/model/taskQueueModel',[\n    'jquery',\n    'lodash',\n    'core/promise',\n    'core/eventifier',\n    'core/polling',\n    'core/dataProvider/request',\n    'jquery.fileDownload'\n], function ($, _, Promise, eventifier, polling, request) {\n    'use strict';\n\n    var _defaults = {\n        url : {\n            get: '',\n            archive: '',\n            all : '',\n            download : ''\n        },\n        pollSingleIntervals : [\n            {iteration: 4, interval:1000},\n        ],\n        pollAllIntervals : [\n            {iteration: 10, interval:5000},\n            {iteration: 0, interval:10000}//infinite\n        ]\n    };\n\n    /**\n     * Check if two tasks have equivalent task status\n     * @param {Object} task1 - a task object to be compared\n     * @param {Object} task2 - another task object to be compared\n     * @returns {Boolean}\n     */\n    function hasSameState(task1, task2){\n        if(task1.status === task2.status){\n            return true;\n        }else if(task1.status === 'created' || task1.status === 'in_progress'){\n            return  (task2.status === 'created' || task2.status === 'in_progress');\n        }\n        return false;\n    }\n\n    /**\n     * Create a task queue model to communicates with the server REST API\n     *\n     * @param {Object} config\n     * @param {Object} config.url - the list of server endpoints\n     * @param {String} config.url.get - the url to get the status log for a single task\n     * @param {String} config.url.archive - the url to archive a task\n     * @param {String} config.url.all - the url to get the status for all tasks for the current user\n     * @param {String} config.url.download - the url to download a file created by the task\n     * @param {Array} config.pollSingleIntervals - the array of poll intervals that will be used to regulate the polling speed for a simple task\n     *         e.g. {iteration: 4, interval:1000} means that it will poll up to four times every 1000ms.\n     * @param {Array} config.pollAllIntervals - the array of poll intervals that will be used to regulate the main polling speed.\n     *         e.g. {iteration: 10, interval:1000} means that it will poll up to 10 times every 5000ms.\n     *         e.g. {iteration: 0, interval:10000} means that it will poll up to 10000ms indefinitely\n     *\n     * @return {taskQueueModel}\n     */\n    return function taskQueueModel(config) {\n\n        var model;\n\n        /**\n         * cached array of task data\n         * @type {Object}\n         */\n        var _cache;\n\n        /**\n         * store instance of single polling\n         * @type {Object}\n         */\n        var singlePollings = {};\n\n        var getPollSingleIntervals = function getPollSingleIntervals(){\n            if(config.pollSingleIntervals && _.isArray(config.pollSingleIntervals)){\n                return _.cloneDeep(config.pollSingleIntervals);\n            }\n        };\n\n        var getPollAllIntervals = function getPollAllIntervals(){\n            if(config.pollAllIntervals && _.isArray(config.pollAllIntervals)){\n                return _.cloneDeep(config.pollAllIntervals);\n            }\n        };\n\n        config = _.defaults(config || {}, _defaults);\n\n        /**\n         * @typedef taskQueueModel - central model to query the backend's REST API for task queue\n         */\n        model = eventifier({\n\n            /**\n             * Modify the task queue REST API endpoints\n             * @param urls - the new endpoints\n             * @returns {taskQueueModel}\n             */\n            setEndpoints : function setEndpoints(urls){\n                _.assign(config.url, urls || {});\n                return this;\n            },\n\n            /**\n             * Get the status of a task identified by its unique task id\n             *\n             * @param {String} taskId - unique task identifier\n             * @returns {Promise}\n             */\n            get : function get(taskId){\n                var status;\n\n                if(!config.url || !config.url.get){\n                    throw new TypeError('config.url.get is not configured while get() is being called');\n                }\n\n                status = request(config.url.get, {taskId: taskId}, 'GET', {}, true)\n                    .then(function(taskData){\n                        //check taskData\n                        if(taskData && taskData.status){\n                            if(_cache){\n                                //detect change\n                                if(!_cache[taskData.id]){\n                                    model.trigger('singletaskadded', taskData);\n                                }else if(!hasSameState(_cache[taskData.id], taskData)){\n                                    //check if the status has changed\n                                    model.trigger('singletaskstatuschange', taskData);\n                                }\n                            }else{\n                                _cache = {};\n                            }\n                            _cache[taskData.id] = taskData;\n                            return taskData;\n                        }\n                        return Promise.reject(new Error('failed to get task data'));\n                    });\n\n                status.catch(function(err){\n                    model.trigger('error', err);\n                });\n\n                return status;\n            },\n\n            /**\n             * Get the status of all task identified by their unique task id\n             *\n             * @returns {Promise} - resolved when the server response has been received\n             */\n            getAll : function getAll(){\n                var status;\n\n                if(!config.url || !config.url.all){\n                    throw new TypeError('config.url.all is not configured while getAll() is being called');\n                }\n\n                status = request(config.url.all, {limit: 100}, 'GET', {}, true)\n                    .then(function(taskData){\n                        var newCache = {};\n                        //check taskData\n                        if(taskData){\n                            if(_cache){\n                                //detect change\n                                _.forEach(taskData, function(task){\n                                    var id = task.id;\n                                    if(!_cache[id]){\n                                        model.trigger('multitaskadded', task);\n                                    }else if(!hasSameState(_cache[id], task)){\n                                        //check if the status has changed\n                                        model.trigger('multitaskstatuschange', task);\n                                    }\n                                    newCache[id] = task;\n                                });\n                                _.forEach(_.difference(_.keys(_cache), _.keys(newCache)), function(id){\n                                    model.trigger('taskremoved', _cache[id]);\n                                });\n                            }else{\n                                _.forEach(taskData, function(task){\n                                    newCache[task.id] = task;\n                                });\n                            }\n                            //update local cache\n                            _cache = newCache;\n\n                            return taskData;\n                        }\n                        return Promise.reject(new Error('failed to get all task data'));\n                    });\n\n                status.catch(function(err){\n                    model.trigger('error', err);\n                });\n\n                return status;\n            },\n\n            /**\n             * Remove a task identified by its unique task id\n             *\n             * @param {String} taskId - the task id\n             * @returns {Promise} - resolved when achive action done\n             */\n            archive : function archive(taskId){\n\n                var status;\n\n                if(!config.url || !config.url.archive){\n                    throw new TypeError('config.url.archive is not configured while archive() is being called');\n                }\n\n                status = request(config.url.archive, {taskId : taskId}, 'GET', {}, true);\n\n                status.catch(function(res){\n                    model.trigger('error', res);\n                });\n\n                return status;\n            },\n\n            /**\n             * Poll status for all tasks\n             * @param {Boolean} [immediate] - tells if the polling should immediately start (otherwise, will wait until the next iteration)\n             * @returns {taskQueueModel}\n             */\n            pollAll : function pollAll(immediate){\n\n                var self = this;\n                var loop = 0;\n                var pollingIntervals = getPollAllIntervals();\n\n                /**\n                 * gradually increase the polling interval to ease server load\n                 * @private\n                 * @param {Object} pollingInstance - a poll object\n                 */\n                var _updateInterval = function _updateInterval(pollingInstance){\n                    var pollingInterval;\n                    if(loop){\n                        loop --;\n                    }else{\n                        pollingInterval = pollingIntervals.shift();\n                        if(pollingInterval && typeof pollingInterval.iteration !== 'undefined' && pollingInterval.interval){\n                            loop = pollingInterval.iteration;\n                            pollingInstance.setInterval(pollingInterval.interval);\n                        }\n                    }\n                };\n\n                if(!config.url || !config.url.all){\n                    throw new TypeError('config.url.all is not configured while pollAll() is being called');\n                }\n\n                if(!this.globalPolling){\n                    //no global polling yet, create one\n                    this.globalPolling = polling({\n                        action: function action() {\n                            // get into asynchronous mode\n                            var done = this.async();\n                            var statusArr;\n                            model.getAll().then(function(taskDataArray){\n                                model.trigger('pollAll', taskDataArray);\n\n                                //smart polling: stop polling when there is no task in progress\n                                statusArr = _.map(taskDataArray, 'status');\n                                if(statusArr.indexOf('in_progress') === -1 && statusArr.indexOf('created') === -1){\n                                    return done.reject();\n                                }\n\n                                _updateInterval(self.globalPolling);\n                                done.resolve();\n                            }).catch(function(){\n                                done.reject();\n                            });\n                        }\n                    });\n                    _updateInterval(this.globalPolling);\n                    this.globalPolling.start();\n                    this.trigger('pollAllStart');\n                }else{\n                    this.globalPolling.start();\n                    this.trigger('pollAllStart');\n                }\n\n                if(immediate){\n                    //if it is request to immediate start polling, start it now\n                    this.globalPolling.next();\n                }\n\n                return model;\n            },\n\n            /**\n             * Stop the main polling action\n             * @returns {taskQueueModel}\n             */\n            pollAllStop : function pollAllStop(){\n                if(this.globalPolling){\n                    this.globalPolling.stop();\n                    this.trigger('pollAllStop');\n                }\n                return this;\n            },\n\n            /**\n             * Start a single fast polling for a single task id\n             * @param {String} taskId - the task id\n             * @returns {Promise} resolved when the single polling action finishes\n             */\n            pollSingle : function pollSingle(taskId){\n\n                var self = this;\n                var loop = 0;\n\n                var pollingIntervals = getPollSingleIntervals();\n\n                /**\n                 * gradually increase the polling interval to ease server load\n                 * @private\n                 * @param {Object} pollingInstance - a poll object\n                 */\n                var _updateInterval = function _updateInterval(pollingInstance){\n                    var pollingInterval;\n                    if(loop){\n                        loop --;\n                        return true;//continue polling\n                    }else{\n                        pollingInterval = pollingIntervals.shift();\n                        if(pollingInterval && pollingInterval.iteration && pollingInterval.interval){\n                            loop = pollingInterval.iteration;\n                            pollingInstance.setInterval(pollingInterval.interval);\n                            return true;//continue polling\n                        }else{\n                            //stop polling\n                            return false;\n                        }\n                    }\n                };\n\n                if(!config.url || !config.url.get){\n                    throw new TypeError('config.url.get is not configured while pollSingle() is being called');\n                }\n\n                if(singlePollings[taskId]){\n                    singlePollings[taskId].stop();\n                }\n\n                return new Promise(function(resolve){\n                    var poll = polling({\n                        action: function action() {\n                            // get into asynchronous mode\n                            var done = this.async();\n                            self.get(taskId).then(function(taskData){\n                                if(taskData.status === 'completed' || taskData.status === 'failed'){\n                                    //the status status could be either \"completed\" or \"failed\"\n                                    poll.stop();\n                                    self.trigger('pollSingleFinished', taskId, taskData);\n                                    resolve({finished: true, task: taskData});\n                                }else if(!_updateInterval(poll)){\n                                    //if we have reached the end of the total polling config\n                                    self.trigger('pollSingleFinished', taskId, taskData);\n                                    resolve({finished: false, task: taskData});\n                                }else{\n                                    self.trigger('pollSingle', taskId, taskData);\n                                    done.resolve();//go to next poll iteration\n                                }\n\n                            }).catch(function(){\n                                done.reject();\n                            });\n                        }\n                    });\n                    _updateInterval(poll);\n                    singlePollings[taskId] = poll.start();\n                    self.trigger('pollSingleStart', taskId);\n                });\n            },\n\n            /**\n             * Interrupt a single polling action\n             * @param {String} taskId - the task id\n             * @returns {model}\n             */\n            pollSingleStop : function pollSingleStop(taskId){\n                if(singlePollings && singlePollings[taskId]){\n                    singlePollings[taskId].stop();\n                    this.trigger('pollSingleStop', taskId);\n                }\n                return this;\n            },\n\n            /**\n             * Call a task creation url\n             * @param {String} url - the server side task queue creation service\n             * @param {Object} [data] - request data\n             * @returns {promise} - resolved when task creation response is sent back by the server\n             */\n            create : function create(url, data){\n                var taskCreate, self = this;\n                taskCreate = request(url, data, 'POST', {}, true)\n                    .then(function(creationResult){\n                        //poll short result:\n                        if(creationResult && creationResult.task && creationResult.task.id){\n                            self.trigger('created', creationResult);\n                            return self.pollSingle(creationResult.task.id).then(function(result){\n                                if(creationResult.extra){\n                                    result.extra = creationResult.extra;\n                                }\n                                if(result.finished){\n                                    //send to queue\n                                    self.trigger('fastFinished', result);\n                                }else{\n                                    //send to queue\n                                    self.trigger('enqueued', result);\n                                }\n                                return result;\n                            });\n                        }\n                        return Promise.reject(new Error('failed to get task data'));\n                    });\n\n                taskCreate.catch(function(err){\n                    model.trigger('error', err);\n                });\n\n                return taskCreate;\n            },\n\n            /**\n             * Call the task result file download endpoint\n             * @param {String} taskId - the task id\n             * @returns {promise} - resolved when the download popup is shown\n             */\n            download : function download(taskId){\n\n                if(!config.url || !config.url.download){\n                    throw new TypeError('config.url.download is not configured while download() is being called');\n                }\n\n                return new Promise(function(resolve, reject){\n                    $.fileDownload(config.url.download, {\n                        httpMethod: 'POST',\n                        data: {taskId : taskId},\n                        successCallback : function(result){\n                            resolve(result);\n                        },\n                        failCallback: function (err) {\n                            reject(err);\n                        }\n                    });\n                });\n            }\n        });\n\n        return model;\n    };\n});\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA ;\n */\ndefine('taoTaskQueue/model/taskQueue',[\n    'util/url',\n    'taoTaskQueue/model/taskQueueModel'\n], function (urlHelper, taskQueueModelFactory) {\n    'use strict';\n\n    /**\n     * Returns the singleton task queue preconfigured with the tao task queue REST API.\n     */\n    return taskQueueModelFactory({\n        url : {\n            get: urlHelper.route('get', 'TaskQueueWebApi', 'taoTaskQueue'),\n            archive: urlHelper.route('archive', 'TaskQueueWebApi', 'taoTaskQueue'),\n            all : urlHelper.route('getAll', 'TaskQueueWebApi', 'taoTaskQueue'),\n            download : urlHelper.route('download', 'TaskQueueWebApi', 'taoTaskQueue')\n        },\n        pollSingleIntervals : [\n            {iteration: 3, interval:1000}\n        ],\n        pollAllIntervals : [\n            {iteration: 1, interval:8000},\n            {iteration: 0, interval:5000}\n        ]\n    });\n});\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA ;\r\n */\r\n/**\r\n * @author Jean-Sbastien Conan <jean-sebastien@taotesting.com>\r\n */\r\ndefine('taoOutcomeUi/plugins/results/action/view',[\r\n    'i18n',\r\n    'layout/actions/binder',\r\n    'core/plugin',\r\n    'util/url'\r\n], function (__, binder, pluginFactory, urlHelper) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Will add a \"View\" button on each line of the list of results\r\n     */\r\n    return pluginFactory({\r\n        name: 'view',\r\n\r\n        init: function init() {\r\n            var resultsList = this.getHost();\r\n            var action = {\r\n                binding: 'load',\r\n                url: urlHelper.route('viewResult', 'Results', 'taoOutcomeUi')\r\n            };\r\n\r\n            // this action will be available for each displayed line in the list\r\n            resultsList.addAction({\r\n                id: 'view',\r\n                label: __('View'),\r\n                icon: 'view',\r\n                action: function viewResults(id) {\r\n                    var context = {\r\n                        id: id,\r\n                        classUri: resultsList.getClassUri()\r\n                    };\r\n\r\n                    binder.exec(action, context);\r\n                }\r\n            });\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA ;\r\n */\r\n/**\r\n * @author Jean-Sbastien Conan <jean-sebastien@taotesting.com>\r\n */\r\ndefine('taoOutcomeUi/plugins/results/action/delete',[\r\n    'jquery',\r\n    'i18n',\r\n    'uri',\r\n    'core/plugin',\r\n    'util/url',\r\n    'util/encode',\r\n    'ui/dialog/confirm',\r\n    'ui/feedback'\r\n], function ($, __, uri, pluginFactory, urlHelper, encode, dialogConfirm, feedback) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Will add a \"Delete\" button on each line of the list of results\r\n     */\r\n    return pluginFactory({\r\n        name: 'delete',\r\n\r\n        init: function init() {\r\n            var resultsList = this.getHost();\r\n\r\n            // this action will be available for each displayed line in the list\r\n            resultsList.addAction({\r\n                id: 'delete',\r\n                label: __('Delete'),\r\n                icon: 'delete',\r\n                action: function deleteResults(id) {\r\n                    // prompt a confirmation dialog and then delete the result\r\n                    dialogConfirm(__('Please confirm deletion'), function () {\r\n                        $.ajax({\r\n                            url: urlHelper.route('delete', 'Results', 'taoOutcomeUi'),\r\n                            type: \"POST\",\r\n                            data: {\r\n                                uri: uri.encode(id)\r\n                            },\r\n                            dataType: 'json'\r\n                        }).done(function (response) {\r\n                            if (response.deleted) {\r\n                                feedback().success(__('Result has been deleted'));\r\n                                resultsList.refresh();\r\n                            } else {\r\n                                feedback().error(__('Something went wrong...') + '<br>' + encode.html(response.error), {encodeHtml: false});\r\n                                resultsList.trigger('error', response.error);\r\n                            }\r\n                        }).fail(function (err) {\r\n                            feedback().error(__('Something went wrong...'));\r\n                            resultsList.trigger('error', err);\r\n                        });\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA ;\r\n */\r\n/**\r\n * @author Jean-Sbastien Conan <jean-sebastien@taotesting.com>\r\n */\r\ndefine('taoOutcomeUi/plugins/results/action/download',[\r\n    'jquery',\r\n    'i18n',\r\n    'core/plugin',\r\n    'util/url',\r\n    'jquery.fileDownload'\r\n], function ($, __, pluginFactory, urlHelper) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Will add a \"Download\" button on each line of the list of results\r\n     */\r\n    return pluginFactory({\r\n        name: 'download',\r\n\r\n        init: function init() {\r\n            var resultsList = this.getHost();\r\n\r\n            // this action will be available for each displayed line in the list\r\n            resultsList.addAction({\r\n                id: 'download',\r\n                label: __('Download'),\r\n                icon: 'download',\r\n                action: function downloadResults(id) {\r\n                    $.fileDownload(urlHelper.route('downloadXML', 'Results', 'taoOutcomeUi'), {\r\n                        preparingMessageHtml: __(\"We are preparing your report, please wait...\"),\r\n                        failMessageHtml: __(\"There was a problem generating your report, please try again.\"),\r\n                        httpMethod: 'GET',\r\n                        data: {\r\n                            id: id,\r\n                            delivery: resultsList.getClassUri()\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA ;\r\n */\r\n/**\r\n * @author Jean-Sbastien Conan <jean-sebastien@taotesting.com>\r\n */\r\ndefine('taoOutcomeUi/component/results/pluginsLoader',[\r\n    'core/pluginLoader',\r\n    'taoOutcomeUi/plugins/results/action/view',\r\n    'taoOutcomeUi/plugins/results/action/delete',\r\n    'taoOutcomeUi/plugins/results/action/download'\r\n], function (pluginLoader, actionView, actionDelete, actionDownload) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Instantiates the plugin loader with all the required plugins configured\r\n     */\r\n    return pluginLoader({\r\n        action: [actionView, actionDelete, actionDownload]\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA ;\r\n */\r\n/**\r\n * @author Jean-Sbastien Conan <jean-sebastien@taotesting.com>\r\n */\r\ndefine('taoOutcomeUi/component/results/areaBroker',[\r\n    'lodash',\r\n    'core/areaBroker'\r\n], function (_, areaBroker) {\r\n    'use strict';\r\n\r\n    var requireAreas = [\r\n        'list'\r\n    ];\r\n\r\n    /**\r\n     * Creates an area broker with the required areas for the list of results\r\n     *\r\n     * @see core/areaBroker\r\n     *\r\n     * @param {jQueryElement|HTMLElement|String} $container - the main container\r\n     * @param {Object} mapping - keys are the area names, values are jQueryElement\r\n     * @returns {broker} the broker\r\n     * @throws {TypeError} without a valid container\r\n     */\r\n    return _.partial(areaBroker, requireAreas);\r\n});\r\n\n","\ndefine('tpl!taoOutcomeUi/component/results/list', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  \n\n\n  return \"<div class=\\\"component results-list\\\">\\r\\n    <div class=\\\"list\\\"></div>\\r\\n</div>\";\n  });\n});\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA ;\r\n */\r\n/**\r\n * @author Jean-Sbastien Conan <jean-sebastien@taotesting.com>\r\n */\r\ndefine('taoOutcomeUi/component/results/list',[\r\n    'jquery',\r\n    'lodash',\r\n    'uri',\r\n    'core/promise',\r\n    'ui/component',\r\n    'taoOutcomeUi/component/results/areaBroker',\r\n    'tpl!taoOutcomeUi/component/results/list',\r\n    'ui/datatable'\r\n], function ($, _, uri, Promise, component, resultsAreaBroker, listTpl) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Component that lists all the results entry points for a particular delivery\r\n     *\r\n     * @param {Object} config\r\n     * @param {String} config.classUri\r\n     * @param {String} config.dataUrl\r\n     * @param {Object} config.model\r\n     * @param {Array} pluginFactories\r\n     * @returns {resultsList}\r\n     */\r\n    function resultsListFactory(config, pluginFactories) {\r\n        var resultsList;\r\n        var areaBroker;\r\n        var plugins = {};\r\n        var actions = [];\r\n        var classUri;\r\n\r\n        /**\r\n         * Calls a method from each plugins\r\n         *\r\n         * @param {String} method - the name of the method to run\r\n         * @returns {Promise} Resolved when all plugins are done\r\n         */\r\n        function pluginRun(method) {\r\n            var execStack = [];\r\n\r\n            _.forEach(plugins, function (plugin) {\r\n                if (_.isFunction(plugin[method])) {\r\n                    execStack.push(plugin[method]());\r\n                }\r\n            });\r\n\r\n            return Promise.all(execStack);\r\n        }\r\n\r\n        if (!_.isPlainObject(config)) {\r\n            throw new TypeError('The configuration is required');\r\n        }\r\n        if (!_.isString(config.classUri) || !config.classUri) {\r\n            throw new TypeError('The class URI is required');\r\n        }\r\n        if (!_.isString(config.dataUrl) || !config.dataUrl) {\r\n            throw new TypeError('The service URL is required');\r\n        }\r\n        if (!_.isPlainObject(config.model) && !_.isArray(config.model)) {\r\n            throw new TypeError('The data model is required');\r\n        }\r\n\r\n        classUri = uri.decode(config.classUri);\r\n\r\n        /**\r\n         *\r\n         * @typedef {resultsList}\r\n         */\r\n        resultsList = component({\r\n\r\n            /**\r\n             * Refreshes the list\r\n             * @returns {resultsList} chains\r\n             */\r\n            refresh: function refresh() {\r\n                areaBroker.getListArea().datatable('refresh');\r\n                return this;\r\n            },\r\n\r\n            /**\r\n             * Add a line action\r\n             * @param {String|Object} name\r\n             * @param {Function|Object} [action]\r\n             * @returns {resultsList} chains\r\n             */\r\n            addAction: function addAction(name, action) {\r\n                var descriptor;\r\n\r\n                if (_.isPlainObject(name)) {\r\n                    descriptor = name;\r\n                } else if (_.isPlainObject(action)) {\r\n                    descriptor = action;\r\n                    action.id = name;\r\n                } else {\r\n                    descriptor = {\r\n                        id: name,\r\n                        label: name\r\n                    };\r\n                }\r\n\r\n                if (_.isFunction(action)) {\r\n                    descriptor.action = action;\r\n                }\r\n                if (!descriptor.label) {\r\n                    descriptor.label = descriptor.id;\r\n                }\r\n\r\n                actions.push(descriptor);\r\n\r\n                return this;\r\n            },\r\n\r\n            /**\r\n             * Gives an access to the config\r\n             * @returns {Object}\r\n             */\r\n            getConfig: function getConfig() {\r\n                return this.config;\r\n            },\r\n\r\n            /**\r\n             * Gets the class URI\r\n             * @returns {String}\r\n             */\r\n            getClassUri: function getClassUri() {\r\n                return classUri;\r\n            },\r\n\r\n            /**\r\n             * Gets the registered actions\r\n             * @returns {Array}\r\n             */\r\n            getActions: function getActions() {\r\n                return actions;\r\n            }\r\n        });\r\n\r\n        return resultsList\r\n            .before('render', function onRender() {\r\n                var self = this;\r\n\r\n                areaBroker = resultsAreaBroker(this.$component, {\r\n                    'list': $('.list', this.$component)\r\n                });\r\n\r\n                _.forEach(pluginFactories, function (pluginFactory) {\r\n                    var plugin = pluginFactory(self, areaBroker);\r\n                    plugins[plugin.getName()] = plugin;\r\n                });\r\n\r\n                return pluginRun('init')\r\n                    .then(function() {\r\n                        return pluginRun('render');\r\n                    })\r\n                    .then(function () {\r\n                        areaBroker.getListArea()\r\n                            .empty()\r\n                            .on('query.datatable', function () {\r\n                                self.setState('loading', true)\r\n                                    .trigger('loading');\r\n                            })\r\n                            .on('load.datatable', function () {\r\n                                self.setState('loading', false)\r\n                                    .trigger('loaded');\r\n                            })\r\n                            .datatable({\r\n                                url: self.config.dataUrl,\r\n                                model: self.config.model,\r\n                                actions: actions,\r\n                                filter: true\r\n                            });\r\n                    })\r\n                    .catch(function (err) {\r\n                        self.trigger('error', err);\r\n                        return Promise.reject(err);\r\n                    });\r\n            })\r\n            .before('destroy', function onDestroy() {\r\n                var self = this;\r\n\r\n                return pluginRun('destroy')\r\n                    .then(function () {\r\n                        areaBroker.getListArea().empty();\r\n                    })\r\n                    .catch(function (err) {\r\n                        self.trigger('error', err);\r\n                    });\r\n            })\r\n            .setTemplate(listTpl)\r\n            .init(config);\r\n    }\r\n\r\n    return resultsListFactory;\r\n});\r\n\n","\ndefine('tpl!taoTaskQueue/component/button/tpl/report', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, functionType=\"function\", escapeExpression=this.escapeExpression;\n\n\n  buffer += \"<div class=\\\"task-report-container\\\">\\n    <div class=\\\"section-header flex-container-full\\\">\\n        <h2>\";\n  if (helper = helpers.title) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.title); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</h2>\\n    </div>\\n    <div class=\\\"main-container flex-container-full report\\\"></div>\\n</div>\";\n  return buffer;\n  });\n});\n\n","\ndefine('css!taoTaskQueue/component/button/css/taskable',[],function(){});\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA;\n */\n\n/**\n * Add the task creation capability to a component\n *\n * @example\n * makeTaskable(component)\n *    .setTaskConfig({\n *        taskQueue : taskQueue,\n *        taskCreationUrl : 'the/url/to/task/creation/service',\n *        taskCreationData : function(){\n *            return {some: 'data'};\n *        }\n *    }).createTask();\n *\n * @author Sam <sam@taotesting.com>\n */\ndefine('taoTaskQueue/component/button/taskable',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'core/promise',\n    'ui/report',\n    'ui/feedback',\n    'layout/loading-bar',\n    'tpl!taoTaskQueue/component/button/tpl/report',\n    'css!taoTaskQueue/component/button/css/taskable',\n], function ($, _, __, Promise, reportFactory, feedback, loadingBar, reportTpl) {\n    'use strict';\n\n    var defaultConfig = {\n    };\n\n    var taskableComponent = {\n\n        /**\n         * Set configuration for task creation\n         * @param config\n         * @returns {taskableComponent}\n         */\n        setTaskConfig : function setTaskConfig(config){\n            _.assign(this.config, config);\n            return this;\n        },\n\n        /**\n         * Create a task\n         * @param requestUrl\n         * @param requestData\n         */\n        createTask : function createTask(){\n            var self = this;\n            var taskQueue,\n                requestUrl,\n                requestData = {};\n\n            //prepare the request parameter if applicable\n            if(_.isFunction(this.config.taskCreationData)){\n                requestData = this.config.taskCreationData.call(this);\n            }else if(_.isPlainObject(this.config.taskCreationData)){\n                requestData = this.config.taskCreationData;\n            }\n\n            if(!this.config.taskCreationUrl){\n                return this.trigger('error', 'the request url is required to create a task');\n            }\n            requestUrl = this.config.taskCreationUrl;\n\n            if(!this.config.taskQueue){\n                return this.trigger('error', 'the taskQueue model is required to create a task');\n            }\n            taskQueue = this.config.taskQueue;\n\n            loadingBar.start();\n            taskQueue.pollAllStop();\n            taskQueue.create(requestUrl, requestData).then(function (result) {\n                var infoBox,\n                    message,\n                    task = result.task;\n\n                if (result.finished) {\n                    if(task.hasFile){\n                        //download if its is a export-typed task\n                        taskQueue.download(task.id).then(function(){\n                            //immediately archive the finished task as there is no need to display this task in the queue list\n                            return taskQueue.archive(task.id);\n                        }).then(function () {\n                            self.trigger('finished', result);\n                            taskQueue.pollAll();\n                        }).catch(function(err){\n                            self.trigger('error', err);\n                            taskQueue.pollAll();\n                        });\n                    }else{\n                        //immediately archive the finished task as there is no need to display this task in the queue list\n                        taskQueue.archive(task.id).then(function(){\n                            self.trigger('finished', result);\n                            taskQueue.pollAll();\n                        }).catch(function(err){\n                            self.trigger('error', err);\n                            taskQueue.pollAll();\n                        });\n                    }\n                } else {\n                    //enqueuing process:\n                    message = __('<strong> %s </strong> has been moved to the background.', task.taskLabel);\n                    infoBox = feedback(null, {\n                        encodeHtml : false,\n                        timeout : {info: 8000}\n                    }).info(message);\n\n                    taskQueue.trigger('taskcreated', {task : task, sourceDom : infoBox.getElement()});\n                    self.trigger('enqueued', result);\n                }\n                loadingBar.stop();\n            }).catch(function (err) {\n                //in case of error display it and continue task queue activity\n                taskQueue.pollAll();\n                self.trigger('error', err);\n            });\n        },\n\n        /**\n         * prepare the given container to display the final report\n         * @param {Object} report - the standard report object\n         * @param {String} title - the report title\n         * @param {String} result - raw result data from the task creation action\n         */\n        displayReport : function displayReport(report, title, result) {\n            var self = this,\n                $reportContainer;\n\n            if(this.config.taskReportContainer instanceof $){\n                $reportContainer = $(reportTpl({\n                    title: title\n                }));\n\n                this.config.taskReportContainer.html($reportContainer);\n\n                return reportFactory({\n                        actions: [{\n                            id: 'continue',\n                            icon: 'right',\n                            title: 'continue',\n                            label: __('Continue')\n                        }]\n                    }, report)\n                    .on('action-continue', function(){\n                        self.trigger('continue', result);\n                    }).render($reportContainer.find('.report'));\n            }\n        }\n    };\n\n    /**\n     * @param {Component} component - an instance of ui/component\n     * @param {Object} config - task queue creation specific config\n     * @param {Object} config.taskQueue - the task queue model to be used\n     * @param {String} config.taskCreationUrl - endpoint to create a task\n     * @param {Object|Function} [config.taskCreationData] - the parameters that will be send to the task creation request\n     * @param {JQuery} [config.taskReportContainer] - the container where the inline report can be printed to\n     * @return {taskableComponent}\n     */\n    return function makeTaskable(component, config) {\n        _.assign(component, taskableComponent);\n\n        /**\n         * @typedef {ui/component} taskableComponent\n         */\n        return component\n            .off('.taskable')\n            .on('init.taskable', function() {\n                _.defaults(this.config, config || {}, defaultConfig);\n            });\n    };\n});\n\n","\ndefine('tpl!taoTaskQueue/component/button/tpl/treeButton', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, functionType=\"function\", escapeExpression=this.escapeExpression;\n\n\n  buffer += \"<div class=\\\"tree-button-component\\\">\\n    <a class=\\\"li-inner\\\">\\n        <span class=\\\"spinner-icon icon-loop spinning\\\"></span>\\n        <span class=\\\"glyph start-icon icon-\";\n  if (helper = helpers.icon) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.icon); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\"></span>\\n        \";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\n    </a>\\n</div>\";\n  return buffer;\n  });\n});\n\n","\ndefine('css!taoTaskQueue/component/button/css/treeButton',[],function(){});\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA ;\n */\n\n/**\n * A button component used to trigger lengthy action from the tree\n *\n * @example\n * treeTaskButtonFactory({\n *    icon : 'export',\n *    label : __('Export CSV'),\n *    taskQueue : taskQueue,\n *    taskCreationUrl : 'the/url/to/task/creation/service',\n * }).render($container).start();\n *\n * @example defer the definition of the taskCreationUrl later:\n * var button = treeTaskButtonFactory({\n *    icon : 'export',\n *    label : __('Export CSV'),\n *    taskQueue : taskQueue\n * }).render($container).start();\n * button.setTaskConfig({taskCreationUrl : 'the/url/to/task/creation/service'}).start();\n *\n * @author Sam <sam@taotesting.com>\n */\ndefine('taoTaskQueue/component/button/treeButton',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'ui/feedback',\n    'ui/component',\n    'layout/loading-bar',\n    'taoTaskQueue/component/button/taskable',\n    'tpl!taoTaskQueue/component/button/tpl/treeButton',\n    'css!taoTaskQueue/component/button/css/treeButton'\n], function ($, _, __, feedback, component, loadingBar, makeTaskable, buttonTpl) {\n    'use strict';\n\n    var _defaults = {\n        icon : 'property-advanced',\n        label : 'OK'\n    };\n\n    var buttonApi = {\n        /**\n         * Start the button spinning\n         * @returns {treeTaskButton}\n         */\n        start : function start(){\n            this.createTask();\n            this.setState('started', true);\n            this.trigger('start');\n            return this;\n        },\n        /**\n         * Stop the button spinning\n         * @returns {treeTaskButton}\n         */\n        stop : function stop(){\n            if(this.is('started')){\n                this.setState('started', false);\n                this.trigger('stop');\n            }\n            return this;\n        }\n    };\n\n    /**\n     * Create a button that will trigger a task creation when clicked\n     *\n     * @param {Object} config - the component config\n     * @param {String} config.icon - the button icon\n     * @param {String} config.label - the button's label\n     * @param {Object} config.taskQueue - the task queue model to be used\n     * @param {String} config.taskCreationUrl - endpoint to create a task\n     * @param {Object|Function} [config.taskCreationData] - the parameters that will be send to the task creation request\n     * @param {JQuery} [config.taskReportContainer] - the container where the inline report can be printed to\n     * @return {treeTaskButton} the component\n     *\n     * @event start - When the button starts spinning\n     * @event stop - When the button stops spinning\n     * @event finished - When task is finished within the polling duration allowed by the task queue model\n     * @event enqueued - when task has not time to finish within the polling duration allowed by the task queue model\n     */\n    return function treeTaskButtonFactory(config) {\n        var initConfig = _.defaults(config || {}, _defaults);\n\n        /**\n         * @typedef {treeTaskButton} the component\n         */\n        return makeTaskable(component(buttonApi))\n            .on('finished', function(){\n                this.stop();\n            })\n            .on('enqueued', function(){\n                this.stop();\n            })\n            .setTemplate(buttonTpl)\n            .init(initConfig);\n    };\n\n});\n","/**\r\n * @author Bertrand Chevrier <bertrand@taotesting.com>\r\n * @author Jean-Sbastien Conan <jean-sebastien@taotesting.com>\r\n */\r\ndefine('taoOutcomeUi/controller/inspectResults',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'module',\r\n    'core/logger',\r\n    'util/url',\r\n    'layout/actions/binder',\r\n    'layout/loading-bar',\r\n    'ui/feedback',\r\n    'taoTaskQueue/model/taskQueue',\r\n    'taoOutcomeUi/component/results/pluginsLoader',\r\n    'taoOutcomeUi/component/results/list',\r\n    'taoTaskQueue/component/button/treeButton'\r\n], function ($, _, __, module, loggerFactory, urlHelper, binder, loadingBar, feedback, taskQueue, resultsPluginsLoader, resultsListFactory, treeTaskButtonFactory) {\r\n    'use strict';\r\n\r\n    var logger = loggerFactory('controller/inspectResults');\r\n\r\n    /**\r\n     * Take care of errors\r\n     * @param err\r\n     */\r\n    function reportError(err) {\r\n        loadingBar.stop();\r\n\r\n        logger.error(err);\r\n\r\n        if (err instanceof Error) {\r\n            feedback().error(err.message);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @exports taoOutcomeUi/controller/resultTable\r\n     */\r\n    return {\r\n\r\n        /**\r\n         * Controller entry point\r\n         */\r\n        start: function () {\r\n            var config = module.config() || {};\r\n            var $container = $('#inspect-result');\r\n            var classUri = $container.data('uri');\r\n            var listConfig = {\r\n                dataUrl: urlHelper.route('getResults', 'Results', 'taoOutcomeUi', {\r\n                    classUri: classUri\r\n                }),\r\n                model: config.dataModel,\r\n                classUri: classUri\r\n            };\r\n            var taskButton;\r\n\r\n            loadingBar.start();\r\n\r\n            _.forEach(config.plugins, function (plugin) {\r\n                if (plugin && plugin.module) {\r\n                    if (plugin.exclude) {\r\n                        resultsPluginsLoader.remove(plugin.module);\r\n                    } else {\r\n                        resultsPluginsLoader.add(plugin);\r\n                    }\r\n                }\r\n            });\r\n\r\n            if ($container.length) {\r\n                resultsPluginsLoader.load()\r\n                    .then(function () {\r\n                        resultsListFactory(listConfig, resultsPluginsLoader.getPlugins())\r\n                            .on('error', reportError)\r\n                            .on('success', function (message) {\r\n                                feedback().success(message);\r\n                            })\r\n                            .before('loading', function() {\r\n                                loadingBar.start();\r\n                            })\r\n                            .after('loaded', function () {\r\n                                loadingBar.stop();\r\n                            })\r\n                            .render($('.inspect-results-grid', $container));\r\n                    })\r\n                    .catch(reportError);\r\n            } else {\r\n                loadingBar.stop();\r\n            }\r\n\r\n            taskButton = treeTaskButtonFactory({\r\n                replace : true,\r\n                icon : 'export',\r\n                label : __('Export CSV'),\r\n                taskQueue : taskQueue\r\n            }).render($('#results-csv-export'));\r\n\r\n            binder.register('export_csv', function remove(actionContext){\r\n                var data = _.pick(actionContext, ['uri', 'classUri', 'id']);\r\n                var uniqueValue = data.uri || data.classUri || '';\r\n                taskButton.setTaskConfig({\r\n                    taskCreationUrl : this.url,\r\n                    taskCreationData : {uri : uniqueValue}\r\n                }).start();\r\n            });\r\n        }\r\n    };\r\n});\r\n\n","\ndefine('tpl!taoOutcomeUi/controller/resultModal', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  \n\n\n  return \"<div class=\\\"modal results-modal\\\">\\r\\n\\r\\n</div>\";\n  });\n});\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2018 (original work) Open Assessment Technologies SA ;\r\n */\r\n/**\r\n * @author Aleksej Tikhanovich, <aleksej@taotesting.com>\r\n */\r\n\r\ndefine('taoOutcomeUi/controller/resultsMonitoring',[\r\n    'jquery',\r\n    'i18n',\r\n    'util/url',\r\n    'uri',\r\n    'ui/feedback',\r\n    'util/locale',\r\n    'util/encode',\r\n    'layout/loading-bar',\r\n    'layout/actions/binder',\r\n    'ui/dialog/confirm',\r\n    'tpl!taoOutcomeUi/controller/resultModal',\r\n    'ui/datatable'\r\n], function ($, __, url, uri, feedback, locale, encode, loadingBar, binder, dialogConfirm, resultModalTpl) {\r\n    'use strict';\r\n\r\n    var $resultsListContainer = $('.results-list-container');\r\n\r\n    function getRequestErrorMessage (xhr) {\r\n        loadingBar.start();\r\n        var message = '';\r\n        try {\r\n            var responseJSON = $.parseJSON(xhr.responseText);\r\n            if (responseJSON.message) {\r\n                message = responseJSON.message;\r\n            } else {\r\n                message = xhr.responseText;\r\n            }\r\n        } catch (e) {\r\n            message = xhr.responseText;\r\n        }\r\n        return message;\r\n    }\r\n\r\n    function viewResult(rowId) {\r\n        var res = parseRowId(rowId);\r\n        loadingBar.start();\r\n        $.ajax({\r\n            url : url.route('viewResult', 'Results', 'taoOutcomeUi', {id : res[0], classUri: res[1]}),\r\n            type : 'GET',\r\n            success : function (result) {\r\n                var $container = $(resultModalTpl()).append(result);\r\n                $resultsListContainer.append($container);\r\n                $container.modal({\r\n                    startClosed : true,\r\n                    minWidth : 450\r\n                });\r\n                $container.modal('open');\r\n                loadingBar.stop();\r\n            },\r\n            error : function (xhr, err) {\r\n                var message = getRequestErrorMessage(xhr);\r\n                feedback().error(message, {encodeHtml : false});\r\n                loadingBar.stop();\r\n            }\r\n        });\r\n    }\r\n\r\n    function removeResult(rowId) {\r\n        var res = parseRowId(rowId);\r\n        // prompt a confirmation dialog and then delete the result\r\n        dialogConfirm(__('Please confirm deletion'), function () {\r\n            $.ajax({\r\n                url: url.route('delete', 'Results', 'taoOutcomeUi'),\r\n                type: \"POST\",\r\n                data: {\r\n                    uri: uri.encode(res[0])\r\n                },\r\n                dataType: 'json'\r\n            }).done(function (response) {\r\n                if (response.deleted) {\r\n                    feedback().success(__('Result has been deleted'));\r\n                    $resultsListContainer.datatable('refresh');\r\n                } else {\r\n                    feedback().error(__('Something went wrong...') + '<br>' + encode.html(response.error), {encodeHtml: false});\r\n                    $resultsListContainer.trigger('error', response.error);\r\n                }\r\n            }).fail(function (err) {\r\n                feedback().error(__('Something went wrong...'));\r\n                $resultsListContainer.trigger('error', err);\r\n            });\r\n        });\r\n    }\r\n\r\n    function downloadResult(rowId) {\r\n        var res = parseRowId(rowId);\r\n        $.fileDownload(url.route('downloadXML', 'Results', 'taoOutcomeUi'), {\r\n            preparingMessageHtml: __(\"We are preparing your report, please wait...\"),\r\n            failMessageHtml: __(\"There was a problem generating your report, please try again.\"),\r\n            httpMethod: 'GET',\r\n            data: {\r\n                id: res[0],\r\n                delivery: res[1]\r\n            }\r\n        });\r\n    }\r\n\r\n    function parseRowId(rowId) {\r\n        return rowId.split(\"|\");\r\n    }\r\n\r\n    return {\r\n        start: function () {\r\n            $resultsListContainer\r\n                .datatable({\r\n                    url: url.route('data', 'ResultsMonitoring', 'taoOutcomeUi'),\r\n                    filter: true,\r\n                    model: [{\r\n                        id: 'delivery',\r\n                        label: __('Delivery'),\r\n                        sortable: false\r\n                    }, {\r\n                        id: 'deliveryResultIdentifier',\r\n                        label: __('Delivery Execution'),\r\n                        sortable: false,\r\n                    }, {\r\n                        id: 'testTakerIdentifier',\r\n                        label: __('Test Taker'),\r\n                        sortable: false\r\n                    }, {\r\n                        id: 'start_time',\r\n                        label: __('Start Time'),\r\n                        sortable: false\r\n                    }],\r\n                    paginationStrategyTop: 'simple',\r\n                    paginationStrategyBottom: 'pages',\r\n                    rows: 25,\r\n                    actions : {\r\n                        'view' : {\r\n                            id: 'view',\r\n                            label: __('View'),\r\n                            icon: 'view',\r\n                            action: viewResult\r\n                        },\r\n                        'remove' : {\r\n                            id : 'remove',\r\n                            title : __('Delete result'),\r\n                            icon : 'bin',\r\n                            label : __('Delete'),\r\n                            action: removeResult\r\n                        },\r\n                        'download' :{\r\n                            id : 'download',\r\n                            title : __('Download result'),\r\n                            icon : 'download',\r\n                            label : __('Download'),\r\n                            action: downloadResult\r\n                        }\r\n                    }\r\n                });\r\n        }\r\n    };\r\n});\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA;\n */\n\n/**\n * Component to create a simple button that will command task creation\n *\n * @example minimal example to build a task\n * standardTaskButtonFactory({\n *    type : 'info',\n *    icon : 'delivery',\n *    title : __('Publish the test'),\n *    label : __('Publish'),\n *    taskQueue : taskQueue,\n *    taskCreationUrl : 'the/url/to/task/creation/service'\n * }).render($container);\n *\n * @example simple example to build a task with additional request params\n * standardTaskButtonFactory({\n *    type : 'info',\n *    icon : 'delivery',\n *    title : __('Publish the test'),\n *    label : __('Publish'),\n *    taskQueue : taskQueue,\n *    taskCreationUrl : 'the/url/to/task/creation/service',\n *    taskCreationData : {foo : 'bar}\n * }).render($container);\n *\n * @example full example using taskCreationData as a function and taskReportContainer to display the report in\n * standardTaskButtonFactory({\n *    type : 'info',\n *    icon : 'delivery',\n *    title : __('Publish the test'),\n *    label : __('Publish'),\n *    taskQueue : taskQueue,\n *    taskCreationUrl : $form.prop('action'),\n *    taskCreationData : function getTaskCreationData(){\n *        return $form.serializeArray();\n *    },\n *    taskReportContainer : $container\n * }).render($container);\n */\ndefine('taoTaskQueue/component/button/standardButton',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'core/promise',\n    'ui/report',\n    'ui/feedback',\n    'layout/loading-bar',\n    'ui/loadingButton/loadingButton',\n    'taoTaskQueue/component/button/taskable'\n], function ($, _, __, Promise, reportFactory, feedback, loadingBar, loadingButton, makeTaskable) {\n    'use strict';\n\n    var defaultConfig = {\n    };\n\n    /**\n     * Builds a standard task creation button\n     *\n     * @param {Object} config - the component config\n     * @param {String} config.type - the icon type (info, success, error)\n     * @param {String} config.icon - the button icon\n     * @param {String} config.label - the button's label\n     * @param {String} [config.title] - the button's title\n     * @param {String} [config.terminatedLabel] - the button's label when terminated\n     * @param {Object} config.taskQueue - the task queue model to be used\n     * @param {String} config.taskCreationUrl - endpoint to create a task\n     * @param {Object|Function} [config.taskCreationData] - the parameters that will be send to the task creation request\n     * @param {JQuery} [config.taskReportContainer] - the container where the inline report can be printed to\n     * @returns {standardTaskButton} the component\n     *\n     * @event started - Emitted when the button is clicked and the triggered action supposed to be started\n     * @event terminated - Emitted when the button action is stopped, interrupted\n     * @event reset - Emitted when the button revert from the terminated stated to the initial one\n     * @event finished - When task is finished within the polling duration allowed by the task queue model\n     * @event enqueued - when task has not time to finish within the polling duration allowed by the task queue model\n     */\n    return function standardTaskButtonFactory(config) {\n\n        var component;\n\n        //prepare the config and\n        config = _.defaults(config || {}, defaultConfig);\n\n        //create the base loading button and make it taskable\n        component = makeTaskable(loadingButton(config));\n\n        /**\n         * The component\n         * @typedef {ui/component} standardTaskButton\n         */\n        return component.on('started', function(){\n            this.createTask();\n        }).on('finished', function(){\n            this.terminate().reset();\n        }).on('enqueued', function(){\n            this.terminate().reset();\n        });\n    };\n});\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2014-2017 (original work) Open Assessment Technologies SA;\r\n */\r\n\r\n/**\r\n * @author Bertrand Chevrier <bertrand@taotesting.com>\r\n */\r\ndefine('taoOutcomeUi/controller/resultTable',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'module',\r\n    'util/url',\r\n    'ui/feedback',\r\n    'taoTaskQueue/model/taskQueue',\r\n    'taoTaskQueue/component/button/standardButton',\r\n    'ui/datatable'\r\n], function($, _, __, module, urlUtil, feedback, taskQueue, standardTaskButtonFactory) {\r\n    'use strict';\r\n\r\n    /**\r\n     * @exports taoOutcomeUi/controller/resultTable\r\n     */\r\n    var resulTableController =  {\r\n\r\n        /**\r\n         * Controller entry point\r\n         */\r\n        start : function(){\r\n\r\n           var conf = module.config();\r\n           var $container = $(\".result-table\");\r\n           var $filterField = $('.result-filter', $container);\r\n           var $tableContainer = $('.result-table-container', $container);\r\n           var filter = conf.filter || 'lastSubmitted';\r\n           var uri = conf.uri || '';\r\n            //keep columns through calls\r\n            var columns = [];\r\n            var groups = {};\r\n            var $actionBar = $container.find('.actions');\r\n\r\n            /**\r\n             * Load columns to rebuild the datatable dynamically\r\n             * @param {String} url  - the URL that retrieve the columns\r\n             * @param {String} [action = 'add'] - 'add' or 'remove' the retrieved columns\r\n             * @param {Function} done - once the datatable is loaded\r\n             */\r\n            var buildGrid = function buildGrid(url, action, done){\r\n                $.ajax({\r\n                    url : url,\r\n                    dataType : 'json',\r\n                    data : {filter : filter, uri : uri},\r\n                    type :'GET'\r\n                }).done(function(response){\r\n                    if(response && response.columns){\r\n                        if(action === 'remove'){\r\n                            columns = _.reject(columns, function(col){\r\n                               return _.find(response.columns, function(resCol){\r\n                                    return _.isEqual(col, resCol);\r\n                               });\r\n                            });\r\n                        } else {\r\n                            if(typeof response.first !== 'undefined' && response.first === true){\r\n                                columns = response.columns.concat(columns);\r\n                            }\r\n                            else{\r\n                                columns = columns.concat(response.columns);\r\n                            }\r\n                        }\r\n                        _buildTable(done);\r\n                    }\r\n                });\r\n            };\r\n\r\n            /**\r\n             * Rebuild the datatable\r\n             * @param {Function} done - once the datatable is loaded\r\n             */\r\n            var _buildTable = function _buildTable(done){\r\n                var model = [];\r\n\r\n                //set up model from columns\r\n                _.forEach(columns, function(col){\r\n                    model.push({\r\n                        id : col.prop ? (col.prop + '_' + col.contextType) : (col.contextId + '_' + col.variableIdentifier),\r\n                        label : col.label,\r\n                        sortable: false\r\n                    });\r\n                });\r\n\r\n                //re-build the datatable\r\n                $tableContainer\r\n                    .empty()\r\n                    .data('ui.datatable', null)\r\n                    .off('load.datatable')\r\n                    .on('load.datatable', function(){\r\n                        if(_.isFunction(done)){\r\n                            done();\r\n                            done = '';\r\n                        }\r\n                    })\r\n                    .datatable({\r\n                        url : urlUtil.route('feedDataTable', 'ResultTable', 'taoOutcomeUi', {filter : filter}),\r\n                        querytype : 'POST',\r\n                        params: {columns: JSON.stringify(columns), '_search': false, uri: uri},\r\n                        model :  model\r\n                    });\r\n            };\r\n\r\n            //group button to toggle them\r\n            $('[data-group]', $container).each(function(){\r\n                var $elt = $(this);\r\n                var group = $elt.data('group');\r\n                var action = $elt.data('action');\r\n                groups[group] = groups[group] || {};\r\n                groups[group][action] = $elt;\r\n            });\r\n\r\n            //regarding button data, we rebuild the table\r\n            $container.on('click', '[data-group]', function(e){\r\n                var $elt    = $(this);\r\n                var group   = $elt.data('group');\r\n                var action  = $elt.data('action');\r\n                var url     = $elt.data('url');\r\n                e.preventDefault();\r\n                buildGrid(url, action, function(){\r\n                    _.forEach(groups[group], function($btn){\r\n                       $btn.toggleClass('hidden');\r\n                    });\r\n                });\r\n            });\r\n\r\n            //default table\r\n            buildGrid(urlUtil.route('getTestTakerColumns', 'ResultTable', 'taoOutcomeUi', {filter : filter}));\r\n\r\n            //setup the filtering\r\n            $filterField.select2({\r\n                minimumResultsForSearch : -1\r\n            }).select2('val', filter);\r\n\r\n            $('.result-filter-btn', $container).click(function() {\r\n                filter = $filterField.select2('val');\r\n                //rebuild the current table\r\n                _buildTable();\r\n            });\r\n\r\n            //instantiate the task creation button\r\n            standardTaskButtonFactory({\r\n                type : 'info',\r\n                icon : 'export',\r\n                title : __('Export CSV File'),\r\n                label : __('Export CSV File'),\r\n                taskQueue : taskQueue,\r\n                taskCreationUrl : urlUtil.route('export', 'ResultTable', 'taoOutcomeUi'),\r\n                taskCreationData : function getTaskRequestData(){\r\n                    return {\r\n                        filter: filter,\r\n                        columns: JSON.stringify(columns),\r\n                        uri: uri\r\n                    };\r\n                }\r\n            }).on('error', function(err){\r\n                feedback().error(err);\r\n            }).render($actionBar);\r\n        }\r\n    };\r\n    return resulTableController;\r\n});\r\n\n","\ndefine(\"json!taoItems/preview/resources/device-list.json\", function(){ return {\r\n    \"tablets\": {\r\n        \"193986c3715c81838870f908fa98d69a\": {\r\n            \"label\": \"Amazon Kindle Fire HDX 7\\u2033\",\r\n            \"width\": 960,\r\n            \"height\": 600\r\n        },\r\n        \"4e8eafab11aad1486992d7ee2c8c16ca\": {\r\n            \"label\": \"Apple iPad\",\r\n            \"width\": 1024,\r\n            \"height\": 768\r\n        },\r\n        \"5aac2932d9ad00d6d8a1604b8f9e4e8d\": {\r\n            \"label\": \"Google Nexus 10, Motorola Xoom, Xyboard\",\r\n            \"width\": 1280,\r\n            \"height\": 800\r\n        },\r\n        \"9805d9753ad08c7630a9ee5418aa6c6c\": {\r\n            \"label\": \"Google Nexus 7\",\r\n            \"width\": 966,\r\n            \"height\": 604\r\n        },\r\n        \"d4a431cedf4705d6bf2cba6d5788378b\": {\r\n            \"label\": \"Samsung Galaxy Tab 7.7, 8.9, 10.1\",\r\n            \"width\": 1280,\r\n            \"height\": 800\r\n        }\r\n    },\r\n    \"phones\": {\r\n        \"1b89338531ef0155c8d6abc2ac02c81a\": {\r\n            \"label\": \"Apple iPhone 3GS\",\r\n            \"width\": 320,\r\n            \"height\": 480,\r\n            \"scaleFactor\": 1,\r\n            \"dpWidth\": 320,\r\n            \"dpHeight\": 480\r\n        },\r\n        \"3f89da99d84214cde7df87ebe0699a6f\": {\r\n            \"label\": \"Apple iPhone 4\",\r\n            \"width\": 640,\r\n            \"height\": 960,\r\n            \"scaleFactor\": 2,\r\n            \"dpWidth\": 320,\r\n            \"dpHeight\": 1920\r\n        },\r\n        \"0d36971a5b98b367f54ced708c9af849\": {\r\n            \"label\": \"Apple iPhone 5\",\r\n            \"width\": 640,\r\n            \"height\": 1136,\r\n            \"scaleFactor\": 2,\r\n            \"dpWidth\": 320,\r\n            \"dpHeight\": 2272\r\n        },\r\n        \"026beffcc051af995660ebdede986ace\": {\r\n            \"label\": \"BlackBerry Z10\",\r\n            \"width\": 768,\r\n            \"height\": 1280,\r\n            \"scaleFactor\": 2,\r\n            \"dpWidth\": 384,\r\n            \"dpHeight\": 2560\r\n        },\r\n        \"fd2dd53e667d6d49e4fa73356fa941dd\": {\r\n            \"label\": \"BlackBerry Z30\",\r\n            \"width\": 720,\r\n            \"height\": 1280,\r\n            \"scaleFactor\": 2,\r\n            \"dpWidth\": 360,\r\n            \"dpHeight\": 2560\r\n        },\r\n        \"707584c1ae17d9b5b2cbe8603c91c147\": {\r\n            \"label\": \"Google Nexus 4\",\r\n            \"width\": 768,\r\n            \"height\": 1280,\r\n            \"scaleFactor\": 2,\r\n            \"dpWidth\": 384,\r\n            \"dpHeight\": 2560\r\n        },\r\n        \"91823264de952e7f2347e07db5c4058b\": {\r\n            \"label\": \"Google Nexus 5\",\r\n            \"width\": 1080,\r\n            \"height\": 1920,\r\n            \"scaleFactor\": 3,\r\n            \"dpWidth\": 360,\r\n            \"dpHeight\": 5760\r\n        },\r\n        \"cd69817a6e147e8a4677389e56fcf568\": {\r\n            \"label\": \"Google Nexus S\",\r\n            \"width\": 480,\r\n            \"height\": 800,\r\n            \"scaleFactor\": 1.5,\r\n            \"dpWidth\": 320,\r\n            \"dpHeight\": 1200\r\n        },\r\n        \"75994faa6a38e31e99b53fcd75534a33\": {\r\n            \"label\": \"HTC Evo, Touch HD, Desire HD, Desire\",\r\n            \"width\": 480,\r\n            \"height\": 800,\r\n            \"scaleFactor\": 1.5,\r\n            \"dpWidth\": 320,\r\n            \"dpHeight\": 1200\r\n        },\r\n        \"0cab4dfccdfc880687cb608cfe4159db\": {\r\n            \"label\": \"HTC One X, EVO LTE\",\r\n            \"width\": 720,\r\n            \"height\": 1280,\r\n            \"scaleFactor\": 2,\r\n            \"dpWidth\": 360,\r\n            \"dpHeight\": 2560\r\n        },\r\n        \"c4ff41fcba24d74fc21dc3490ca1edc9\": {\r\n            \"label\": \"HTC Sensation, Evo 3D\",\r\n            \"width\": 540,\r\n            \"height\": 960,\r\n            \"scaleFactor\": 1.5,\r\n            \"dpWidth\": 360,\r\n            \"dpHeight\": 1440\r\n        },\r\n        \"fa969a5e0dd2de53700eeee4ba4ba142\": {\r\n            \"label\": \"LG Optimus 2X, Optimus 3D, Optimus Black\",\r\n            \"width\": 480,\r\n            \"height\": 800,\r\n            \"scaleFactor\": 1.5,\r\n            \"dpWidth\": 320,\r\n            \"dpHeight\": 1200\r\n        },\r\n        \"33c4f9364e295ec03531f3a3425819cf\": {\r\n            \"label\": \"LG Optimus G\",\r\n            \"width\": 768,\r\n            \"height\": 1280,\r\n            \"scaleFactor\": 2,\r\n            \"dpWidth\": 384,\r\n            \"dpHeight\": 2560\r\n        },\r\n        \"bc47f5275f0efd56fee52d43a8082981\": {\r\n            \"label\": \"LG Optimus LTE, Optimus 4X HD\",\r\n            \"width\": 720,\r\n            \"height\": 1280,\r\n            \"scaleFactor\": 1.7,\r\n            \"dpWidth\": 424,\r\n            \"dpHeight\": 2176\r\n        },\r\n        \"0732887e6e324fd10777b735520a34cf\": {\r\n            \"label\": \"LG Optimus One\",\r\n            \"width\": 320,\r\n            \"height\": 480,\r\n            \"scaleFactor\": 1.5,\r\n            \"dpWidth\": 213,\r\n            \"dpHeight\": 720\r\n        },\r\n        \"2e38a78364f09d0da0e9e1a3a68e7fb0\": {\r\n            \"label\": \"Motorola Defy, Droid, Droid X, Milestone\",\r\n            \"width\": 480,\r\n            \"height\": 854,\r\n            \"scaleFactor\": 1.5,\r\n            \"dpWidth\": 320,\r\n            \"dpHeight\": 1281\r\n        },\r\n        \"bd4b78dddc7c9625a4141a1b1ddabb87\": {\r\n            \"label\": \"Motorola Droid 3, Droid 4, Droid Razr, Atrix 4G, Atrix 2\",\r\n            \"width\": 540,\r\n            \"height\": 960,\r\n            \"scaleFactor\": 1,\r\n            \"dpWidth\": 540,\r\n            \"dpHeight\": 960\r\n        },\r\n        \"3bf1edf21cfa81006183d2b02974c84e\": {\r\n            \"label\": \"Motorola Droid Razr HD\",\r\n            \"width\": 720,\r\n            \"height\": 1280,\r\n            \"scaleFactor\": 1,\r\n            \"dpWidth\": 720,\r\n            \"dpHeight\": 1280\r\n        },\r\n        \"ab5a352e0e016b97dac986f06c394f55\": {\r\n            \"label\": \"Nokia C5, C6, C7, N97, N8, X7\",\r\n            \"width\": 360,\r\n            \"height\": 640,\r\n            \"scaleFactor\": 1,\r\n            \"dpWidth\": 360,\r\n            \"dpHeight\": 640\r\n        },\r\n        \"4826fb7d7257aeaac992ce699df41b3c\": {\r\n            \"label\": \"Nokia Lumia 7X0, Lumia 8XX, Lumia 900, N800, N810, N900\",\r\n            \"width\": 480,\r\n            \"height\": 800,\r\n            \"scaleFactor\": 1.5,\r\n            \"dpWidth\": 320,\r\n            \"dpHeight\": 1200\r\n        },\r\n        \"0a691ab20add7c432200f8fa6527b488\": {\r\n            \"label\": \"Samsung Galaxy Note\",\r\n            \"width\": 800,\r\n            \"height\": 1280,\r\n            \"scaleFactor\": 2,\r\n            \"dpWidth\": 400,\r\n            \"dpHeight\": 2560\r\n        },\r\n        \"9c23ee31be29960fbac9e9bbfc2fc7b0\": {\r\n            \"label\": \"Samsung Galaxy Note 3\",\r\n            \"width\": 1080,\r\n            \"height\": 1920,\r\n            \"scaleFactor\": 2,\r\n            \"dpWidth\": 540,\r\n            \"dpHeight\": 3840\r\n        },\r\n        \"92177c0508c1d73905a58e2338f2a81f\": {\r\n            \"label\": \"Samsung Galaxy Note II\",\r\n            \"width\": 720,\r\n            \"height\": 1280,\r\n            \"scaleFactor\": 2,\r\n            \"dpWidth\": 360,\r\n            \"dpHeight\": 2560\r\n        },\r\n        \"5222b8866dc4cc606725e16ffcc0a783\": {\r\n            \"label\": \"Samsung Galaxy S III, Galaxy Nexus\",\r\n            \"width\": 720,\r\n            \"height\": 1280,\r\n            \"scaleFactor\": 2,\r\n            \"dpWidth\": 360,\r\n            \"dpHeight\": 2560\r\n        },\r\n        \"37c1541e2bd55cfd0f4073b0ccdf68b3\": {\r\n            \"label\": \"Samsung Galaxy S, S II, W\",\r\n            \"width\": 480,\r\n            \"height\": 800,\r\n            \"scaleFactor\": 1.5,\r\n            \"dpWidth\": 320,\r\n            \"dpHeight\": 1200\r\n        },\r\n        \"2f7f64b7dda0144907ff300e83eed465\": {\r\n            \"label\": \"Samsung Galaxy S4\",\r\n            \"width\": 1080,\r\n            \"height\": 1920,\r\n            \"scaleFactor\": 3,\r\n            \"dpWidth\": 360,\r\n            \"dpHeight\": 5760\r\n        },\r\n        \"9c24f9057744dad56043702a9703127f\": {\r\n            \"label\": \"Sony Xperia S, Ion\",\r\n            \"width\": 720,\r\n            \"height\": 1280,\r\n            \"scaleFactor\": 2,\r\n            \"dpWidth\": 360,\r\n            \"dpHeight\": 2560\r\n        },\r\n        \"0a8b2732a016a9395c3af5f12dd9c0da\": {\r\n            \"label\": \"Sony Xperia Sola, U\",\r\n            \"width\": 480,\r\n            \"height\": 854,\r\n            \"scaleFactor\": 1,\r\n            \"dpWidth\": 480,\r\n            \"dpHeight\": 854\r\n        },\r\n        \"5a153d7f53d82dcb0801f041574a6a43\": {\r\n            \"label\": \"Sony Xperia Z, Z1\",\r\n            \"width\": 1080,\r\n            \"height\": 1920,\r\n            \"scaleFactor\": 3,\r\n            \"dpWidth\": 360,\r\n            \"dpHeight\": 5760\r\n        }\r\n    },\r\n    \"screens\": {\r\n        \"9e523ae15b61dc766f5c818726881ecf\": {\r\n            \"label\": \"1920 \\u00d7 1080\",\r\n            \"width\": 1920,\r\n            \"height\": 1080,\r\n            \"dpWidth\": 1920,\r\n            \"dpHeight\": 1080,\r\n            \"scaleFactor\": 1\r\n        },\r\n        \"07769cd8d0a7d09818b2f0b018042fb7\": {\r\n            \"label\": \"1366 \\u00d7 768\",\r\n            \"width\": 1366,\r\n            \"height\": 768,\r\n            \"dpWidth\": 1366,\r\n            \"dpHeight\": 768,\r\n            \"scaleFactor\": 1\r\n        },\r\n        \"72d5478a24194f98b9378e8e0fd65737\": {\r\n            \"label\": \"1280 \\u00d7 1024\",\r\n            \"width\": 1280,\r\n            \"height\": 1024,\r\n            \"dpWidth\": 1280,\r\n            \"dpHeight\": 1024,\r\n            \"scaleFactor\": 1\r\n        },\r\n        \"b7a6dd5900cc72e61f0d3479c7e314ec\": {\r\n            \"label\": \"1280 \\u00d7 800\",\r\n            \"width\": 1280,\r\n            \"height\": 800,\r\n            \"dpWidth\": 1280,\r\n            \"dpHeight\": 800,\r\n            \"scaleFactor\": 1\r\n        },\r\n        \"43193b0ff671a37d8232ab664190a125\": {\r\n            \"label\": \"1024 \\u00d7 768\",\r\n            \"width\": 1024,\r\n            \"height\": 768,\r\n            \"dpWidth\": 1024,\r\n            \"dpHeight\": 768,\r\n            \"scaleFactor\": 1\r\n        },\r\n        \"c29e48814af5443ff5688d9e967ce917\": {\r\n            \"label\": \"800 \\u00d7 600\",\r\n            \"width\": 800,\r\n            \"height\": 600,\r\n            \"dpWidth\": 800,\r\n            \"dpHeight\": 600,\r\n            \"scaleFactor\": 1\r\n        }\r\n    }\r\n};});\n\n","\ndefine('tpl!taoItems/preview/tpl/preview', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, functionType=\"function\", escapeExpression=this.escapeExpression, self=this, helperMissing=helpers.helperMissing;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"\\r\\n                        <option value=\\\"\";\n  if (helper = helpers.value) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.value); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.selected), {hash:{},inverse:self.noop,fn:self.program(2, program2, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \">\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</option>\\r\\n                        \";\n  return buffer;\n  }\nfunction program2(depth0,data) {\n  \n  \n  return \"selected=\\\"selected\\\"\";\n  }\n\nfunction program4(depth0,data) {\n  \n  var buffer = \"\", stack1;\n  buffer += \"\\r\\n                    <select class=\\\"preview-theme-selector\\\">\\r\\n                        \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.themes), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n                    </select>\\r\\n                    \";\n  return buffer;\n  }\n\nfunction program6(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"\\r\\n                        <option value=\\\"\";\n  if (helper = helpers.value) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.value); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" data-value=\\\"\";\n  if (helper = helpers.dataValue) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.dataValue); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.selected), {hash:{},inverse:self.noop,fn:self.program(2, program2, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \">\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</option>\\r\\n                        \";\n  return buffer;\n  }\n\n  buffer += \"<div class=\\\"preview-overlay tao-scope overlay preview-\";\n  if (helper = helpers.previewType) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.previewType); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \" item-no-print\\\"\\r\\n     style=\\\"display:none\\\">\\r\\n    <div class=\\\"preview-container-outer\\\">\\r\\n        <form class=\\\"preview-utility-bar plain\\\">\\r\\n            <div class=\\\"preview-utility-bar-inner grid-row\\\">\\r\\n\\r\\n                <div class=\\\"col-4\\\">\\r\\n                    <input type=\\\"hidden\\\" value=\\\"\\\" data-value=\\\"\\\" class=\\\"standard-device-selector preview-device-selector\\\" data-target=\\\"standard\\\">\\r\\n                    <select class=\\\"preview-type-selector\\\">\\r\\n                        \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.previewTypes), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n                    </select>\\r\\n                    \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.hasThemes), {hash:{},inverse:self.noop,fn:self.program(4, program4, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n                </div>\\r\\n                <div class=\\\"col-6 standard-only device-type-and-orientation\\\"></div>\\r\\n                <div class=\\\"col-6 desktop-only device-type-and-orientation\\\">\\r\\n                    <select class=\\\"desktop-device-selector preview-device-selector\\\" data-target=\\\"desktop\\\">\\r\\n                        \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.desktopDevices), {hash:{},inverse:self.noop,fn:self.program(6, program6, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n                    </select>\\r\\n                </div>\\r\\n                <div class=\\\"col-6 mobile-only device-type-and-orientation\\\">\\r\\n                    <select class=\\\"mobile-device-selector preview-device-selector\\\" data-target=\\\"mobile\\\">\\r\\n                        \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.mobileDevices), {hash:{},inverse:self.noop,fn:self.program(6, program6, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n                    </select>\\r\\n                    <select tabindex=\\\"-1\\\" class=\\\"mobile-orientation-selector orientation-selector\\\"\\r\\n                            data-target=\\\"mobile\\\">\\r\\n                        <option value=\\\"landscape\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Landscape\", options) : helperMissing.call(depth0, \"__\", \"Landscape\", options)))\n    + \"</option>\\r\\n                        <option value=\\\"portrait\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Portrait\", options) : helperMissing.call(depth0, \"__\", \"Portrait\", options)))\n    + \"</option>\\r\\n                    </select>\\r\\n                </div>\\r\\n                <div class=\\\"col-2\\\">\\r\\n                    <span class=\\\"btn-info small preview-closer rgt\\\">\\r\\n                        \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Close\", options) : helperMissing.call(depth0, \"__\", \"Close\", options)))\n    + \"\\r\\n                        <span class=\\\"icon-close r\\\"></span>\\r\\n                    </span>\\r\\n                </div>\\r\\n            </div>\\r\\n            <div class=\\\"preview-message-box\\\">\\r\\n                <div class=\\\"feedback-info small\\\">\\r\\n                    <span class=\\\"icon-info\\\"></span>\\r\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"This preview may be scaled to fit your screen. The final rendering may differ.\", options) : helperMissing.call(depth0, \"__\", \"This preview may be scaled to fit your screen. The final rendering may differ.\", options)))\n    + \"\\r\\n                    <a href=\\\"#\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Dont show this again!\", options) : helperMissing.call(depth0, \"__\", \"Dont show this again!\", options)))\n    + \"</a>\\r\\n                    <span title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Remove this message\", options) : helperMissing.call(depth0, \"__\", \"Remove this message\", options)))\n    + \"\\\" class=\\\"icon-close close-trigger\\\"></span>\\r\\n                </div>\\r\\n            </div>\\r\\n        </form>\\r\\n        <div class=\\\"preview-canvas\\\">\\r\\n            <div class=\\\"preview-scale-container\\\">\\r\\n                <div class=\\\"\";\n  if (helper = helpers.previewType) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.previewType); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"-preview-frame preview-outer-frame \";\n  if (helper = helpers.previewType) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.previewType); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"-preview-landscape\\\">\\r\\n                    <div class=\\\"\";\n  if (helper = helpers.previewType) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.previewType); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"-preview-container preview-container\\\">\\r\\n                        <div class=\\\"preview-item-container\\\"></div>\\r\\n                    </div>\\r\\n                </div>\\r\\n            </div>\\r\\n        </div>\\r\\n    </div>\\r\\n\\r\\n\\r\\n    <div id=\\\"preview-console\\\">\\r\\n        <span class=\\\"icon-close preview-console-closer\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Close console\", options) : helperMissing.call(depth0, \"__\", \"Close console\", options)))\n    + \"\\\"></span>\\r\\n        <div class=\\\"preview-console-header grid-row clearfix\\\">\\r\\n            <ul class=\\\"col-10 plain action-bar extra-button-action-bar horizontal-action-bar\\\">\\r\\n            </ul>\\r\\n            <ul class=\\\"col-2 plain action-bar console-button-action-bar horizontal-action-bar\\\">\\r\\n                <li class=\\\"small btn-info action action-button rgt\\\" id=\\\"preview-submit-button\\\">\\r\\n                    <a class=\\\"li-inner\\\" href=\\\"#\\\">\\r\\n                        <span class=\\\"label\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Submit\", options) : helperMissing.call(depth0, \"__\", \"Submit\", options)))\n    + \"</span>\\r\\n                    </a>\\r\\n                </li>\\r\\n            </ul>\\r\\n        </div>\\r\\n        <div class=\\\"preview-console-body clear\\\">\\r\\n            <ul></ul>\\r\\n        </div>\\r\\n    </div>\\r\\n</div>\\r\\n\\r\\n\\r\\n\\r\\n\";\n  return buffer;\n  });\n});\n\n","\ndefine('css!taoItemsCss/preview',[],function(){});\n","/*\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2015 (original work) Open Assessment Techniologies SA\r\n *\r\n */\r\ndefine('taoItems/preview/preview',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'util/strPad',\r\n    'core/promise',\r\n    'json!taoItems/preview/resources/device-list.json',\r\n    'tpl!taoItems/preview/tpl/preview',\r\n    'ui/themes',\r\n    'ui/themeLoader',\r\n    'urlParser',\r\n    'ui/modal',\r\n    'select2',\r\n    'jquery.cookie',\r\n    'css!taoItemsCss/preview'\r\n], function ($, _, __, strPad, Promise, deviceList, previewTpl, themeHandler, themeLoader, UrlParser) {\r\n    'use strict';\r\n\r\n\r\n    var overlay,\r\n        container,\r\n        orientation = 'landscape',\r\n        previewType = 'standard',\r\n        previewTypes = {\r\n            desktop: __('Desktop preview'),\r\n            mobile: __('Mobile preview'),\r\n            standard: __('Actual size')\r\n        },\r\n        themeObj = themeHandler.get('items') || {},\r\n        $doc = $(document),\r\n        $window = $(window),\r\n        $body = $(document.body),\r\n        screenSize = {\r\n            width: $window.innerWidth(),\r\n            height: $window.innerHeight()\r\n        },\r\n        sizeSettings = {\r\n            width: 0,\r\n            height: 0\r\n        },\r\n        scaleFactor = 1,\r\n        typeDependant,\r\n        $feedbackBox,\r\n        $console,\r\n        previewContainerMaxWidth,\r\n        itemUri,\r\n        state,\r\n        winScrollObj = { x:0, y:0 };\r\n\r\n\r\n    /**\r\n     * Create data set for device selectors\r\n     *\r\n     * @param type\r\n     * @returns {Array}\r\n     * @private\r\n     */\r\n    var _getDeviceSelectorData = function (type) {\r\n\r\n        /*\r\n         * @todo\r\n         * The device list is currently based on the devices found on the Chrome emulator.\r\n         * This is not ideal and should be changed in the future.\r\n         * I have http://en.wikipedia.org/wiki/List_of_displays_by_pixel_density in mind but we\r\n         * will need to figure what criteria to apply when generating the list.\r\n         */\r\n        var devices = type === 'mobile' ? deviceList.tablets : deviceList.screens,\r\n            options = [];\r\n\r\n        _.forEach(devices, function (value) {\r\n\r\n            options.push({\r\n                value: value.label,\r\n                label: value.label,\r\n                dataValue: [value.width, value.height].join(','),\r\n                selected: previewType === value.label\r\n            });\r\n        });\r\n\r\n\r\n        return options;\r\n    };\r\n\r\n    /**\r\n     * Collect all elements that can toggle their class name between mobile-* and desktop-*\r\n     *\r\n     * @private\r\n     */\r\n    var _setupTypeDependantElements = function () {\r\n        typeDependant = overlay.add(overlay.find('.preview-scale-container').find('[class*=\"' + previewType + '\"]'));\r\n    };\r\n\r\n\r\n    /**\r\n     * Change the class name of all type dependant elements\r\n     *\r\n     * @param {String} newType\r\n     */\r\n    var _setPreviewType = function (newType) {\r\n\r\n        if (newType === previewType) {\r\n            return;\r\n        }\r\n        var re = new RegExp(previewType, 'g');\r\n\r\n        typeDependant.each(function (i, el) {\r\n            el.className = el.className.replace(re, newType);\r\n        });\r\n\r\n        previewType = newType;\r\n    };\r\n\r\n\r\n    /**\r\n     * Set orientation\r\n     *\r\n     * @param {String} newOrientation\r\n     * @private\r\n     */\r\n    var _setOrientation = function (newOrientation) {\r\n        if (newOrientation === orientation) {\r\n            return;\r\n        }\r\n\r\n        var re = new RegExp(orientation, 'g'),\r\n            previewFrame = $('.preview-outer-frame')[0];\r\n\r\n        previewFrame.className = previewFrame.className.replace(re, newOrientation);\r\n\r\n        // reset global orientation\r\n        orientation = newOrientation;\r\n    };\r\n\r\n    /**\r\n     * Scale devices down to fit screen\r\n     * @private\r\n     */\r\n    var _scale = function () {\r\n\r\n        _computeScaleFactor();\r\n\r\n        var $scaleContainer = $('.preview-scale-container'),\r\n            _scaleFactor = previewType === 'standard' ? 1 : scaleFactor,\r\n            containerScaledWidth = $scaleContainer.width() * _scaleFactor,\r\n            left = (screenSize.width - containerScaledWidth) / 2;\r\n\r\n        $scaleContainer.css({\r\n            left: left > 0 ? left : 0,\r\n            '-webkit-transform': 'scale(' + _scaleFactor + ',' + _scaleFactor + ')',\r\n            '-ms-transform': 'scale(' + _scaleFactor + ',' + _scaleFactor + ')',\r\n            'transform': 'scale(' + _scaleFactor + ',' + _scaleFactor + ')',\r\n            '-webkit-transform-origin': '0 0',\r\n            '-ms-transform-origin': '0 0',\r\n            'transform-origin': '0 0'\r\n        });\r\n    };\r\n\r\n    /**\r\n     * position the preview depending on the height of the toolbar\r\n     *\r\n     * @private\r\n     */\r\n    var _positionPreview = function () {\r\n        var topBarHeight = $(\".preview-utility-bar\").outerHeight();\r\n\r\n        overlay[0].style.top = topBarHeight + 'px';\r\n        overlay[0].style.maxHeight = 'calc(100vh - ' + topBarHeight + 'px - ' + $console.outerHeight() + 'px )';\r\n    };\r\n\r\n\r\n    /**\r\n     * Compute scale factor based on screen size and device size\r\n     *\r\n     * @private\r\n     */\r\n    var _computeScaleFactor = function () {\r\n\r\n        var scaleValues = {\r\n            x: 1,\r\n            y: 1\r\n        };\r\n\r\n        // 150/200 = device frames plus toolbar plus console plus some margin\r\n\r\n        var requiredSize = {\r\n            width: sizeSettings.width + 150,\r\n            height: sizeSettings.height + 275\r\n        };\r\n\r\n        if (requiredSize.width > screenSize.width) {\r\n            scaleValues.x = screenSize.width / requiredSize.width;\r\n        }\r\n\r\n        if (requiredSize.height > screenSize.height) {\r\n            scaleValues.y = screenSize.height / requiredSize.height;\r\n        }\r\n\r\n        scaleFactor = Math.min(scaleValues.x, scaleValues.y);\r\n    };\r\n\r\n    /**\r\n     * Add functionality to device selectors\r\n     *\r\n     * @private\r\n     */\r\n    var _setupDeviceSelectors = function () {\r\n\r\n\r\n        var previewDeviceSelectors = overlay.find('.preview-device-selector');\r\n\r\n        previewDeviceSelectors.on('change', function () {\r\n            var elem = $(this),\r\n                option = this.nodeName.toLowerCase() === 'select' ? this.options[this.selectedIndex] : this,\r\n                type = elem.data('target'),\r\n                val = $(option).data('value').split(','),\r\n                i = val.length,\r\n                container = overlay.find('.' + type + '-preview-container');\r\n\r\n\r\n            while (i--) {\r\n                val[i] = parseFloat(val[i]);\r\n            }\r\n\r\n            if (type === 'mobile' && orientation === 'portrait') {\r\n                sizeSettings = {\r\n                    width: val[1],\r\n                    height: val[0]\r\n                };\r\n            }\r\n            else {\r\n                sizeSettings = {\r\n                    width: val[0],\r\n                    height: val[1]\r\n                };\r\n            }\r\n\r\n            if (sizeSettings.width === container.width() && sizeSettings.height === container.height()) {\r\n                return false;\r\n            }\r\n\r\n            _setPreviewType(type);\r\n            container.css(sizeSettings);\r\n            _scale();\r\n            _adaptFrameSize();\r\n        });\r\n\r\n        previewDeviceSelectors.each(function () {\r\n            if (this.nodeName.toLowerCase() === 'select') {\r\n                $(this).select2({\r\n                    minimumResultsForSearch: -1\r\n                });\r\n            }\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Setup orientation selector. There is no actual orientation switch for desktop but it could\r\n     * be added easily if required.\r\n     * @private\r\n     */\r\n    var _setupOrientationSelectors = function () {\r\n\r\n        $('select.orientation-selector').on('change',function () {\r\n\r\n            var type = $(this).data('target'),\r\n                previewFrame = $('.' + type + '-preview-frame'),\r\n                container = previewFrame.find('.' + type + '-preview-container'),\r\n                newOrientation = $(this).val();\r\n\r\n            if (newOrientation === orientation) {\r\n                return false;\r\n            }\r\n\r\n            sizeSettings = {\r\n                height: container.width(),\r\n                width: container.height()\r\n            };\r\n\r\n            container.css(sizeSettings);\r\n\r\n            _setOrientation(newOrientation);\r\n\r\n            _scale();\r\n            _adaptFrameSize();\r\n\r\n\r\n        }).select2({\r\n            minimumResultsForSearch: -1\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Close preview\r\n     *\r\n     * @returns {*|HTMLElement}\r\n     */\r\n    var _setupClosers = function () {\r\n        var $closer = overlay.find('.preview-closer'),\r\n            $feedbackCloser = $feedbackBox.find('.close-trigger'),\r\n            $hideForever = $feedbackBox.find('a');\r\n        var $iframe = $('#preview-iframe');\r\n\r\n        $closer.on('click', function () {\r\n            $doc.trigger('itemunload.preview');\r\n//            commonRenderer.setContext($('.item-editor-item'));\r\n\r\n            window.scrollTo(winScrollObj.x, winScrollObj.y);\r\n\r\n            overlay.hide();\r\n            $body.removeClass('preview-mode');\r\n\r\n            //empty the iframe\r\n            $iframe.off('load').attr('src', 'about:blank');\r\n        });\r\n\r\n        $doc.keyup(function (e) {\r\n            if (e.keyCode === 27) {\r\n                $closer.trigger('click');\r\n            }\r\n        });\r\n\r\n        $feedbackCloser.on('click', function () {\r\n            $feedbackBox.hide();\r\n            $body.addClass('no-preview-feedback');\r\n            _positionPreview();\r\n            _scale();\r\n        });\r\n\r\n        $hideForever.on('click', function (e) {\r\n            e.preventDefault();\r\n            $.cookie('hidePreviewFeedback', true, { expires: 1000, path: '/' });\r\n            $feedbackCloser.trigger('click');\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Build options for themes\r\n     *\r\n     * @todo is there a way to know the selected theme?\r\n     *\r\n     * @returns {Array}\r\n     * @private\r\n     */\r\n    var _getThemes = function() {\r\n\r\n        var options = [];\r\n        var activeTheme;\r\n\r\n        //don't load themes if there is none\r\n        if(_.isPlainObject(themeObj) && !_.isEmpty(themeObj.base)){\r\n            activeTheme = themeLoader(themeObj).getActiveTheme();\r\n\r\n            _(themeObj.available).forEach(function (data) {\r\n                options.push({\r\n                    value: data.id,\r\n                    label: data.name,\r\n                    selected: data.id === activeTheme\r\n                });\r\n            });\r\n        }\r\n        return options;\r\n    };\r\n\r\n    /**\r\n     * Build options for preview types\r\n     *\r\n     * @returns {Array}\r\n     * @private\r\n     */\r\n    var _getPreviewTypes = function () {\r\n        var options = [];\r\n        _(previewTypes).forEach(function (_previewLabel, _previewType) {\r\n            options.push({\r\n                value: _previewType,\r\n                label: _previewLabel,\r\n                selected: previewType === _previewType\r\n            });\r\n        });\r\n        return options;\r\n    };\r\n\r\n    /**\r\n     * Select preview type\r\n     *\r\n     * @private\r\n     */\r\n    var _setupViewSelector = function () {\r\n\r\n        $('select.preview-type-selector').on('change',function () {\r\n            var _previewType = $(this),\r\n                value = _previewType.val();\r\n\r\n            _setPreviewType(value);\r\n\r\n            $('.' + value + '-device-selector').trigger('change');\r\n        }).select2({\r\n            minimumResultsForSearch: -1\r\n        });\r\n\r\n    };\r\n\r\n\r\n    /**\r\n     * Select preview theme\r\n     *\r\n     * @private\r\n     */\r\n    var _setupThemeSelector = function () {\r\n        $('select.preview-theme-selector').on('change',function () {\r\n            var iframe = document.getElementById('preview-container');\r\n            var iframeDoc = iframe.contentWindow || iframe.contentDocument;\r\n            iframeDoc.$('.qti-item').trigger('themechange', [$(this).val()]);\r\n\r\n        }).select2({\r\n            minimumResultsForSearch: -1\r\n        });\r\n\r\n    };\r\n\r\n    var _adaptFrameSize = function () {\r\n\r\n        var $previewContainer = $('.preview-container'),\r\n            $iframe = (function () {\r\n                var _iframe = $previewContainer.find('iframe');\r\n                _iframe.height('');\r\n                return _iframe;\r\n            }()),\r\n            contentHeight = $iframe.contents().outerHeight(),\r\n            containerHeight = $previewContainer.innerHeight();\r\n\r\n        if (previewType !== 'standard') {\r\n            if (contentHeight < containerHeight) {\r\n                contentHeight = containerHeight;\r\n            }\r\n        }\r\n        else {\r\n            $previewContainer.height(contentHeight + 10);\r\n        }\r\n\r\n        $iframe.height(contentHeight);\r\n    };\r\n\r\n\r\n    /**\r\n     * Set the size for the standard preview\r\n     * @param height\r\n     * @private\r\n     */\r\n    var _updateStandardPreviewSize = function (height) {\r\n        var $selector = $('.standard-device-selector'),\r\n            values = ($selector.val() ? $selector.val().split(',') : '') || [$window.width().toString()],\r\n            valueStr = values.join(',');\r\n\r\n        values[1] = height || values[1] || '1200';\r\n\r\n        $selector.val(valueStr).data('value', valueStr);\r\n    };\r\n\r\n\r\n    /**\r\n     * Console\r\n     *\r\n     * @private\r\n     */\r\n    var _initConsole = function () {\r\n        var $body = $console.find('.preview-console-body'),\r\n            $listing = $body.find('ul'),\r\n            $closer = $console.find('.preview-console-closer');\r\n\r\n        $console.off('updateConsole').on('updateConsole', function (event, type, message) {\r\n            var timer = new Date(),\r\n                logTime = [\r\n                    strPad(timer.getHours(), 2, '0', 'STR_PAD_LEFT'),\r\n                    strPad(timer.getMinutes(), 2, '0', 'STR_PAD_LEFT'),\r\n                    strPad(timer.getSeconds(), 2, '0', 'STR_PAD_LEFT')\r\n                ].join(':'),\r\n                msgStr = '<span class=\"log-time\">' + strPad(logTime, 12, ' ') + '</span> ' +\r\n                    '<span class=\"log-type\">' + strPad(type, 18, ' ') + '</span> ' +\r\n                    '<span class=\"log-message\">' + strPad(message, 18, ' ') + '</span>';\r\n            $listing.append('<li><pre>' + msgStr + '</pre></li>');\r\n            if (!$body.is(':visible')) {\r\n                $body.slideDown('slow', function () {\r\n                    $closer.show();\r\n                    $listing.scrollTop(10000);\r\n                });\r\n            }\r\n            else {\r\n                $listing.scrollTop(10000);\r\n            }\r\n        });\r\n\r\n        $closer.on('click', function () {\r\n            $body.slideUp('slow', function () {\r\n                $closer.hide();\r\n            });\r\n        });\r\n    };\r\n\r\n\r\n\r\n    /**\r\n     * Display the preview\r\n     * @returns {Promise} resolve once the preview is shown\r\n     */\r\n    var show = function () {\r\n        return new Promise(function (resolve, reject){\r\n            var parsed = new UrlParser(itemUri);\r\n            parsed.params.state = JSON.stringify(state);\r\n            $.ajax({\r\n                url: itemUri,\r\n                dataType: 'html',\r\n                method : 'POST',\r\n                data : parsed.params\r\n            }).done(function (data) {\r\n\r\n                winScrollObj = { x: window.scrollX, y: window.scrollY };\r\n                window.scrollTo(0,0);\r\n\r\n                $body.addClass('preview-mode');\r\n\r\n                // $.show() does not work from the item manager\r\n                // this is either a miracle or a jquery bug\r\n                // overlay.hide().show();\r\n                overlay[0].style.display = 'block';\r\n\r\n                overlay.find('select:visible').not('.preview-theme-selector').trigger('change');\r\n                _scale();\r\n                _positionPreview();\r\n                $('.preview-item-container').html(data);\r\n                resolve();\r\n\r\n            }).fail(function(xhr){\r\n                reject(new Error(__('Unable to render the item from %s : %s %s', itemUri, xhr.status, xhr.statusText)));\r\n            });\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Setting up screen size according preview viewport size\r\n     * @private\r\n     */\r\n    function _setupScreenSize() {\r\n        screenSize = {\r\n            width: $('.preview-overlay').innerWidth(),\r\n            height: $('.preview-overlay').innerHeight()\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Create preview\r\n     *\r\n     * @param {String} _itemUri\r\n     * @param {Object} _state\r\n     */\r\n    var init = function (_itemUri, _state) {\r\n\r\n        if(!_itemUri || _itemUri.length === 0){\r\n            throw new TypeError('Wrong URI');\r\n        }\r\n\r\n        $('.preview-overlay').remove();\r\n        container = null;\r\n        overlay = $(previewTpl({\r\n            mobileDevices: _getDeviceSelectorData('mobile'),\r\n            desktopDevices: _getDeviceSelectorData('desktop'),\r\n            previewTypes: _getPreviewTypes(),\r\n            previewType: previewType,\r\n            themes: _getThemes(),\r\n            hasThemes: _.size(themeObj.available) > 1\r\n        }));\r\n\r\n        $body.append(overlay);\r\n\r\n        previewContainerMaxWidth = parseInt($('.preview-container').css('max-width'), 10);\r\n\r\n        $feedbackBox = overlay.find('.preview-message-box');\r\n        if ($.cookie('hidePreviewFeedback')) {\r\n            $feedbackBox.hide();\r\n            $body.addClass('no-preview-feedback');\r\n        }\r\n\r\n        $console = overlay.find('#preview-console');\r\n\r\n        _initConsole();\r\n        _updateStandardPreviewSize();\r\n        _setupTypeDependantElements();\r\n        _setupDeviceSelectors();\r\n        _setupOrientationSelectors();\r\n        _setupViewSelector();\r\n        _setupThemeSelector();\r\n        _setupClosers();\r\n        _setupScreenSize();\r\n        _computeScaleFactor();\r\n        _setPreviewType(previewType);\r\n        _setOrientation(orientation);\r\n\r\n        $window.on('resize orientationchange', function () {\r\n            _setupScreenSize();\r\n            _updateStandardPreviewSize();\r\n            _computeScaleFactor();\r\n            _scale();\r\n        });\r\n\r\n        itemUri = _itemUri;\r\n        state = _state;\r\n\r\n        return overlay;\r\n    };\r\n\r\n    return {\r\n        init: init,\r\n        show: show\r\n    };\r\n});\r\n\n","/**\r\n * @author Bertrand Chevrier <bertrand@taotesting.com>\r\n */\r\ndefine('taoOutcomeUi/controller/viewResult',[\r\n    'module',\r\n    'jquery',\r\n    'i18n',\r\n    'util/url',\r\n    'layout/section',\r\n    'taoItems/preview/preview',\r\n    'jquery.fileDownload'\r\n], function (module, $,  __,  urlHelper, section, preview) {\r\n    'use strict';\r\n\r\n    /**\r\n     * @exports taoOutcomeUi/controller/viewResult\r\n     */\r\n    var viewResultController =  {\r\n\r\n        /**\r\n         * Controller entry point\r\n         */\r\n        start : function(){\r\n           var conf = module.config();\r\n           var $container = $('#view-result');\r\n           var $resultFilterField = $('.result-filter', $container);\r\n           var $classFilterField = $('[name=\"class-filter\"]', $container);\r\n           var classFilter = JSON.parse(conf.filterTypes) || [];\r\n            //set up filter field\r\n            $resultFilterField.select2({\r\n                minimumResultsForSearch : -1\r\n            }).select2('val', conf.filterSubmission || 'all');\r\n\r\n            for(var i in classFilter){\r\n                $('[value=\"'+classFilter[i]+'\"]').prop('checked', 'checked');\r\n            }\r\n\r\n            $('.result-filter-btn', $container).click(function(e) {\r\n                classFilter = [''];\r\n                $classFilterField.each(function(){\r\n                    if($(this).prop('checked')){\r\n                        classFilter.push($(this).val());\r\n                    }\r\n                });\r\n                section.loadContentBlock(\r\n                    urlHelper.route('viewResult', 'Results', 'taoOutcomeUi'), {\r\n                    id: conf.id,\r\n                    classUri:  conf.classUri,\r\n                    filterSubmission: $resultFilterField.select2('val'),\r\n                    filterTypes: classFilter\r\n                });\r\n            });\r\n\r\n\r\n            //bind the download buttons\r\n            $('.download', $container).on(\"click\", function (e) {\r\n                var variableUri = $(this).val();\r\n                $.fileDownload(urlHelper.route('getFile', 'Results', 'taoOutcomeUi'), {\r\n                    preparingMessageHtml: __(\"We are preparing your report, please wait...\"),\r\n                    failMessageHtml: __(\"There was a problem generating your report, please try again.\"),\r\n                    httpMethod: \"POST\",\r\n                    //This gives the current selection of filters (facet based query) and the list of columns selected from the client (the list of columns is not kept on the server side class.taoTable.php\r\n                    data: {'variableUri': variableUri, 'deliveryUri':conf.classUri}\r\n                });\r\n            });\r\n\r\n            $('.preview', $container).on(\"click\", function (e) {\r\n                var $this = $(this);\r\n                var uri = $this.data('uri');\r\n                var state = $this.data('state');\r\n                e.preventDefault();\r\n                window.scrollTo(0,0);\r\n                preview.init(urlHelper.route('forwardMe', 'ItemPreview', 'taoItems', {uri : uri}), state);\r\n                preview.show();\r\n            });\r\n\r\n        }\r\n    };\r\n\r\n    return viewResultController;\r\n});\r\n\n","\n(function(c){var d=document,a='appendChild',i='styleSheet',s=d.createElement('style');s.type='text/css';d.getElementsByTagName('head')[0][a](s);s[i]?s[i].cssText=c:s[a](d.createTextNode(c));})\n('div.task-report-container{width:100%}\\n\\n/*# sourceMappingURL=taskable.css.map */.tree-button-component .spinner-icon{font-size:17px;font-size:1.7rem;width:17px;height:17px;display:none;margin:12px auto 4px}.tree-button-component.started{background:#ddd;color:#666}.tree-button-component.started .li-inner{cursor:progress}.tree-button-component.started .spinner-icon{display:block;-webkit-transform:translateZ(0);-moz-transform:translateZ(0);-ms-transform:translateZ(0);-o-transform:translateZ(0);transform:translateZ(0);-webkit-transform-origin:50% 50%;-moz-transform-origin:50% 50%;-ms-transform-origin:50% 50%;-o-transform-origin:50% 50%;transform-origin:50% 50%;-webkit-animation:tree-button-rotate 1.4s infinite linear;-moz-animation:tree-button-rotate 1.4s infinite linear;-ms-animation:tree-button-rotate 1.4s infinite linear;-o-animation:tree-button-rotate 1.4s infinite linear;animation:tree-button-rotate 1.4s infinite linear}@-o-keyframes tree-button-rotate{0%{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-ms-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-ms-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes tree-button-rotate{0%{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-ms-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-ms-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes tree-button-rotate{0%{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-ms-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-ms-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes tree-button-rotate{0%{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-ms-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-ms-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}.tree-button-component.started .start-icon{display:none !important}\\n\\n/*# sourceMappingURL=treeButton.css.map */body.preview-mode{height:100vh !important;max-height:100vh;overflow:hidden}body.no-preview-feedback .preview-overlay .preview-container{background:white;overflow:auto}body.no-preview-feedback .preview-overlay .preview-container .preview-item-container,body.no-preview-feedback .preview-overlay .preview-container #preview-container{min-height:calc(100vh - 82px) !important}.preview-overlay{display:none;width:100%;height:100%;z-index:19995;position:absolute;left:0;background:rgba(0,0,0,0.7)}.preview-overlay.preview-desktop{overflow:visible}.preview-overlay.preview-desktop .mobile-only,.preview-overlay.preview-desktop .standard-only{display:none !important}.preview-overlay.preview-mobile{overflow:visible}.preview-overlay.preview-mobile .desktop-only,.preview-overlay.preview-mobile .standard-only{display:none !important}.preview-overlay.preview-standard{overflow:visible}.preview-overlay.preview-standard .desktop-only,.preview-overlay.preview-standard .mobile-only{display:none !important}.preview-overlay .preview-scale-container{position:relative;float:left}.preview-overlay .preview-container{background:white;overflow:auto}.preview-overlay .preview-container .preview-item-container,.preview-overlay .preview-container #preview-container{min-height:calc(100vh - 130px) !important}.preview-overlay .preview-container-outer{display:table;padding:0;width:100%;height:100%}.preview-overlay .preview-utility-bar{background:#f3f1ef;border-bottom:1px solid #8d949e;margin-bottom:20px;z-index:9996;overflow:hidden;padding:10px;position:fixed;top:0;left:0;width:100%}.preview-overlay .preview-utility-bar .preview-heading{min-width:140px}.preview-overlay .preview-utility-bar .device-type-and-orientation{min-width:340px}.preview-overlay .preview-utility-bar-inner{max-width:1024px;width:100%;margin:auto}.preview-overlay .preview-utility-bar-inner h1{font-size:18px;font-size:1.8rem;text-shadow:1px 1px 0px #eee}.preview-overlay .preview-utility-bar-inner .icon-info{top:7px;font-size:15px;font-size:1.5rem}.preview-overlay .preview-utility-bar-inner li{margin-left:10px}.preview-overlay .preview-utility-bar-inner .btn-info{margin-top:1px}.preview-overlay .preview-utility-bar-inner .mobile-device-selector{width:200px}.preview-overlay .preview-utility-bar-inner .preview-type-selector{width:140px}.preview-overlay .preview-utility-bar-inner .preview-theme-selector{width:140px}.preview-overlay .preview-utility-bar-inner .orientation-selector,.preview-overlay .preview-utility-bar-inner .desktop-device-selector{width:130px}.preview-overlay .preview-utility-bar-inner [class*=\\\" col-\\\"],.preview-overlay .preview-utility-bar-inner [class^=\\\"col-\\\"]{margin-bottom:0 !important}.preview-overlay #preview-console{margin:0;padding:0;border:none;z-index:auto;background:#266d9c;position:fixed;bottom:0;left:0;width:100%}.preview-overlay #preview-console .preview-console-closer{position:absolute;right:10px;top:10px;cursor:pointer;color:rgba(255,255,255,0.9);display:none;text-shadow:none}.preview-overlay #preview-console .preview-console-closer:hover{color:white}.preview-overlay #preview-console .preview-console-header{max-width:1024px;width:100%;margin:auto;padding:0}.preview-overlay #preview-console .preview-console-header [class*=\\\" col-\\\"],.preview-overlay #preview-console .preview-console-header [class^=\\\"col-\\\"]{margin-bottom:0 !important}.preview-overlay #preview-console .extra-button-action-bar{overflow:visible}.preview-overlay #preview-console .extra-button-action-bar li{margin:0 5px}.preview-overlay #preview-console .extra-button-action-bar li.btn-info{border-color:rgba(255,255,255,0.3)}.preview-overlay #preview-console .extra-button-action-bar li.btn-info.btn-group{border:none !important;overflow:visible;padding:0}.preview-overlay #preview-console .extra-button-action-bar li.btn-info.btn-group a{float:left;margin:0 2px;padding:0 15px;border:1px solid rgba(255,255,255,0.3);border-radius:0px;display:inline-block;height:inherit}.preview-overlay #preview-console .extra-button-action-bar li.btn-info.btn-group a:first-of-type{border-top-left-radius:3px;border-bottom-left-radius:3px;margin-left:0}.preview-overlay #preview-console .extra-button-action-bar li.btn-info.btn-group a:last-of-type{border-top-right-radius:3px;border-bottom-right-radius:3px;margin-right:0}.preview-overlay #preview-console .extra-button-action-bar li.btn-info.btn-group a:hover,.preview-overlay #preview-console .extra-button-action-bar li.btn-info.btn-group a.active{border-color:rgba(255,255,255,0.8)}.preview-overlay #preview-console .extra-button-action-bar li.btn-info.btn-group a .no-label{padding-right:0}.preview-overlay #preview-console .extra-button-action-bar li.btn-info:hover,.preview-overlay #preview-console .extra-button-action-bar li.btn-info.active{border-color:rgba(255,255,255,0.8)}.preview-overlay #preview-console .extra-button-action-bar.horizontal-action-bar.bottom-action-bar{overflow:visible}.preview-overlay #preview-console .extra-button-action-bar.horizontal-action-bar.bottom-action-bar .action{line-height:1.6}.preview-overlay #preview-console .preview-console-body{display:none}.preview-overlay #preview-console .preview-console-body ul{padding:5px;margin:0;height:300px;overflow:auto;background:#2b2b2b;font-family:Consolas,\\\"Andale Mono WT\\\",\\\"Andale Mono\\\",\\\"Lucida Console\\\",\\\"Lucida Sans Typewriter\\\",\\\"DejaVu Sans Mono\\\",\\\"Bitstream Vera Sans Mono\\\",\\\"Liberation Mono\\\",\\\"Nimbus Mono L\\\",Monaco,\\\"Courier New\\\",Courier,monospace;color:#fff}.preview-overlay #preview-console .preview-console-body ul .log-time{color:#999}.preview-overlay #preview-console .preview-console-body ul .log-type{color:#eee}.preview-overlay #preview-console .preview-console-body ul .log-message{color:#69f}.preview-overlay #preview-console .preview-console-body ul pre{margin:0}.preview-overlay .preview-message-box .feedback-info{margin:10px auto 0px;width:800px}.preview-overlay .preview-message-box a{float:right;padding-right:10px}.preview-overlay .desktop-preview-container{width:1024px;background:white url(data:image/gif;base64,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) no-repeat center 150px}.preview-overlay .desktop-preview-frame{position:relative;border:3px #aaa solid;border-radius:5px;background:#5a5a5a;background:linear-gradient(135deg, #5a5a5a 0%, #565656 7%, #444 15%, #141414 30%);box-shadow:5px 5px 10px 0 rgba(0,0,0,0.7)}.preview-overlay .desktop-preview-frame.desktop-preview-landscape{padding:30px 30px}.preview-overlay .desktop-preview-frame.desktop-preview-landscape .desktop-device-toolbar{padding-right:30px}.preview-overlay .desktop-preview-frame.desktop-preview-portrait{padding:30px 30px}.preview-overlay .desktop-preview-frame.desktop-preview-portrait .desktop-device-toolbar{padding-right:30px}.preview-overlay .desktop-preview-item-container{min-height:500px;-webkit-box-shadow:0px 0px 8px #b7b1ac;-moz-box-shadow:0px 0px 8px #b7b1ac;box-shadow:0px 0px 8px #b7b1ac}.preview-overlay .preview-canvas{display:table-cell;text-align:center}.preview-overlay .preview-canvas *{text-align:left}.preview-overlay .preview-outer-frame{position:relative;display:inline-block}.preview-overlay .mobile-preview-container{-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box;position:relative}.preview-overlay .mobile-preview-item-container{height:100%}.preview-overlay .mobile-preview-frame{position:relative;border:3px #aaa ridge;border-radius:25px;background:#5a5a5a;background:linear-gradient(135deg, #5a5a5a 0%, #565656 7%, #444 15%, #141414 30%);box-shadow:5px 5px 10px 0 rgba(0,0,0,0.7)}.preview-overlay .mobile-preview-frame.mobile-preview-landscape{padding:40px 40px}.preview-overlay .mobile-preview-frame.mobile-preview-landscape .mobile-device-toolbar{padding-right:40px}.preview-overlay .mobile-preview-frame.mobile-preview-portrait{padding:40px 40px}.preview-overlay .mobile-preview-frame.mobile-preview-portrait .mobile-device-toolbar{padding-right:40px}.preview-overlay .mobile-preview-container{background:white;border-radius:3px;border:2px solid;border-color:#444 #999 #999 #444}.preview-overlay .standard-preview-frame{box-shadow:0px 0px 8px rgba(0,0,0,0.7)}\\r\\n\\r\\n/*# sourceMappingURL=preview.css.map */');\n"]}